<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ““ ãƒãƒ¼ãƒˆ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600&family=Noto+Serif+JP:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { overflow: hidden; font-family: 'Noto Sans JP', sans-serif; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #4a4a50; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #5a5a60; }
    .resizer { width: 4px; cursor: col-resize; background: transparent; transition: background 0.2s; }
    .resizer:hover { background: #8b7355; }
    
    /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
    @media (max-width: 768px) {
      .desktop-only { display: none !important; }
      .mobile-nav { 
        position: fixed !important; 
        bottom: 0 !important; 
        left: 0 !important; 
        right: 0 !important; 
        height: 60px !important; 
        width: 100% !important;
        flex-direction: row !important; 
        justify-content: space-around !important;
        z-index: 1000;
        border-top: 1px solid #3a3a40;
        border-right: none !important;
      }
      .mobile-nav > div:first-child { display: none !important; }
      .mobile-sidebar {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 60px !important;
        width: 100% !important;
        z-index: 999;
      }
      .mobile-main {
        padding-bottom: 60px !important;
      }
    }
    @media (min-width: 769px) {
      .mobile-only { display: none !important; }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback, useMemo } = React;

    // ==================== ã‚¢ã‚¤ã‚³ãƒ³ ====================
    const Icons = {
      Home: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
      Edit: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
      Book: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
      FileText: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
      Folder: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>,
      File: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>,
      Plus: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
      X: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ChevronDown: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"/></svg>,
      ChevronRight: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>,
      Sun: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>,
      Moon: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>,
      Settings: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
      Play: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
      Pause: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="none"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>,
      RotateCcw: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>,
      Trash: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
      Check: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>,
      Eye: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
      EyeOff: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>,
      ExternalLink: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
      GripVertical: () => <svg width="10" height="16" viewBox="0 0 10 16" fill="currentColor"><circle cx="2" cy="2" r="1.5"/><circle cx="8" cy="2" r="1.5"/><circle cx="2" cy="8" r="1.5"/><circle cx="8" cy="8" r="1.5"/><circle cx="2" cy="14" r="1.5"/><circle cx="8" cy="14" r="1.5"/></svg>,
      Download: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
      Upload: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
      Lightbulb: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 18h6"/><path d="M10 22h4"/><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"/></svg>,
      Archive: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="21 8 21 21 3 21 3 8"/><rect x="1" y="3" width="22" height="5"/><line x1="10" y1="12" x2="14" y2="12"/></svg>,
      Tag: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>,
      Calendar: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
      Film: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="2" y1="7" x2="7" y2="7"/><line x1="2" y1="17" x2="7" y2="17"/><line x1="17" y1="17" x2="22" y2="17"/><line x1="17" y1="7" x2="22" y2="7"/></svg>,
      Lock: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
      Cloud: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>,
      CloudUpload: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/></svg>,
      CloudDownload: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="8 17 12 21 16 17"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.88 18.09A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.29"/></svg>,
      Shield: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
    };

    // ==================== æš—å·åŒ–ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ====================
    const CryptoUtils = {
      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰æš—å·åŒ–ã‚­ãƒ¼ã‚’ç”Ÿæˆ
      async deriveKey(password, salt) {
        const encoder = new TextEncoder();
        const keyMaterial = await crypto.subtle.importKey(
          'raw', encoder.encode(password), 'PBKDF2', false, ['deriveBits', 'deriveKey']
        );
        return crypto.subtle.deriveKey(
          { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
          keyMaterial, { name: 'AES-GCM', length: 256 }, true, ['encrypt', 'decrypt']
        );
      },
      
      // ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–
      async encrypt(data, password) {
        const salt = crypto.getRandomValues(new Uint8Array(16));
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const key = await this.deriveKey(password, salt);
        const encoder = new TextEncoder();
        const encrypted = await crypto.subtle.encrypt(
          { name: 'AES-GCM', iv }, key, encoder.encode(JSON.stringify(data))
        );
        // salt + iv + encrypted data ã‚’Base64ã§è¿”ã™
        const combined = new Uint8Array(salt.length + iv.length + encrypted.byteLength);
        combined.set(salt, 0);
        combined.set(iv, salt.length);
        combined.set(new Uint8Array(encrypted), salt.length + iv.length);
        return btoa(String.fromCharCode(...combined));
      },
      
      // ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å·
      async decrypt(encryptedBase64, password) {
        try {
          const combined = new Uint8Array(atob(encryptedBase64).split('').map(c => c.charCodeAt(0)));
          const salt = combined.slice(0, 16);
          const iv = combined.slice(16, 28);
          const encrypted = combined.slice(28);
          const key = await this.deriveKey(password, salt);
          const decrypted = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, encrypted);
          return JSON.parse(new TextDecoder().decode(decrypted));
        } catch (e) {
          throw new Error('å¾©å·ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚');
        }
      },
      
      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥ï¼ˆæ¤œè¨¼ç”¨ï¼‰
      async hashPassword(password) {
        const encoder = new TextEncoder();
        const data = encoder.encode(password + 'noteapp-salt-v1');
        const hash = await crypto.subtle.digest('SHA-256', data);
        return btoa(String.fromCharCode(...new Uint8Array(hash)));
      }
    };

    // ==================== GitHub Gist API ====================
    const GistAPI = {
      async saveToGist(token, gistId, encryptedData, passwordHash) {
        const content = JSON.stringify({ encrypted: encryptedData, hash: passwordHash, version: 2 });
        const body = {
          description: 'NoteApp Backup (Encrypted)',
          public: false,
          files: { 'noteapp-backup.json': { content } }
        };
        
        const url = gistId 
          ? `https://api.github.com/gists/${gistId}`
          : 'https://api.github.com/gists';
        
        const response = await fetch(url, {
          method: gistId ? 'PATCH' : 'POST',
          headers: {
            'Authorization': `token ${token}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(body)
        });
        
        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || 'Gistã¸ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
        
        return response.json();
      },
      
      async loadFromGist(token, gistId) {
        const response = await fetch(`https://api.github.com/gists/${gistId}`, {
          headers: { 'Authorization': `token ${token}` }
        });
        
        if (!response.ok) {
          throw new Error('Gistã‹ã‚‰ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
        
        const gist = await response.json();
        const file = gist.files['noteapp-backup.json'];
        if (!file) throw new Error('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        
        return JSON.parse(file.content);
      }
    };

    // ==================== ãƒ†ãƒ¼ãƒ ====================
    const getTheme = (dark) => ({
      bg: dark ? '#1a1a1f' : '#f8f7f4',
      bgSecondary: dark ? '#232328' : '#ffffff',
      bgTertiary: dark ? '#2a2a30' : '#f0efe9',
      text: dark ? '#e8e6e3' : '#2d2d2d',
      textSecondary: dark ? '#9a9a9a' : '#666666',
      border: dark ? '#3a3a40' : '#e0ddd5',
      accent: dark ? '#8b7355' : '#6b5344',
      accentLight: dark ? '#a08060' : '#8b7355',
      highlight: dark ? '#3d3a35' : '#fff9e6',
      success: '#4ade80',
      warning: '#fbbf24',
      error: '#f87171',
      tagColors: ['#ef4444', '#f97316', '#eab308', '#22c55e', '#06b6d4', '#3b82f6', '#8b5cf6', '#ec4899'],
    });

    // ==================== åˆæœŸãƒ‡ãƒ¼ã‚¿ ====================
    const initialData = {
      creative: {
        inProgress: [{ id: 'work-1', name: 'æ–°è¦ä½œå“', tags: [], expanded: true, targetCount: 0, items: [
          { id: 'item-1', type: 'chapter', name: '1è©±', content: '' },
          { id: 'item-2', type: 'memo', name: 'ãƒ—ãƒ­ãƒƒãƒˆ', content: '# ç¬¬ä¸€ç« \n## ã‚·ãƒ¼ãƒ³1\nã“ã“ã«å†…å®¹' },
        ]}],
        completed: [],
        onHold: [], // åˆ¶ä½œä¸­æ–­ï¼ˆä½œå“å˜ä½ï¼‰
        holdItems: [], // ä¿ç•™ï¼ˆè©±å˜ä½ï¼‰
        ideas: [], // ãƒã‚¿ä¿ç®¡åº«
      },
      daily: [], // æ—¥å¸¸ãƒ¡ãƒ¢
      input: [], // Inputï¼ˆèª­æ›¸ãƒ»æ˜ ç”»ãªã©ï¼‰
      reminders: [],
      tags: ['BL', 'ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼', 'ãƒ›ãƒ©ãƒ¼', 'ãƒ„ã‚¤ãƒãƒ™', 'ã‚ªãƒ¡ã‚¬ãƒãƒ¼ã‚¹'],
      dailyTags: ['ä»•äº‹', 'è²·ã„ç‰©', 'ã‚¢ã‚¤ãƒ‡ã‚¢', 'æ—¥è¨˜'],
      inputTags: ['å°èª¬', 'æ¼«ç”»', 'Audible', 'æ˜ ç”»', 'ãƒ‰ãƒ©ãƒ', 'ã‚¢ãƒ‹ãƒ¡', 'YouTube'],
      progress: {},
      settings: { 
        pomodoroWork: 25, 
        pomodoroBreak: 5, 
        calendarEmbed: '',
        sidebarWidth: 280,
      },
      widgetLayout: [
        { id: 'weather', x: 0, y: 0, w: 2, h: 2 },
        { id: 'timer', x: 2, y: 0, w: 2, h: 2 },
        { id: 'todayProgress', x: 4, y: 0, w: 2, h: 2 },
        { id: 'reminders', x: 6, y: 0, w: 6, h: 2 },
        { id: 'calendar', x: 0, y: 2, w: 6, h: 4 },
        { id: 'weeklyChart', x: 6, y: 2, w: 6, h: 2 },
        { id: 'links', x: 6, y: 4, w: 6, h: 2 },
      ],
      collapsedSections: { completed: true, onHold: true, holdItems: true }, // æŠ˜ã‚ŠãŸãŸã¿çŠ¶æ…‹
    };

    // ==================== ã‚¿ã‚¤ãƒãƒ¼ ====================
    const PomodoroTimer = ({ theme, settings }) => {
      const [mode, setMode] = useState('work');
      const [timeLeft, setTimeLeft] = useState(settings.pomodoroWork * 60);
      const [isRunning, setIsRunning] = useState(false);
      const [customWork, setCustomWork] = useState(settings.pomodoroWork);
      const [customBreak, setCustomBreak] = useState(settings.pomodoroBreak);
      const audioContextRef = useRef(null);

      const playSound = useCallback((type) => {
        try {
          if (!audioContextRef.current) {
            audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
          }
          const ctx = audioContextRef.current;
          const oscillator = ctx.createOscillator();
          const gainNode = ctx.createGain();
          oscillator.connect(gainNode);
          gainNode.connect(ctx.destination);
          const sounds = {
            workStart: { freq: 523.25, type: 'sine', duration: 0.3 },
            workEnd: { freq: 783.99, type: 'triangle', duration: 0.5 },
            breakStart: { freq: 392, type: 'sine', duration: 0.4 },
            breakEnd: { freq: 659.25, type: 'square', duration: 0.2 },
          };
          const sound = sounds[type];
          oscillator.frequency.value = sound.freq;
          oscillator.type = sound.type;
          gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + sound.duration);
          oscillator.start(ctx.currentTime);
          oscillator.stop(ctx.currentTime + sound.duration);
        } catch (e) { console.log('Audio not supported'); }
      }, []);

      useEffect(() => {
        let interval;
        if (isRunning && timeLeft > 0) {
          interval = setInterval(() => setTimeLeft(t => t - 1), 1000);
        } else if (timeLeft === 0 && isRunning) {
          if (mode === 'work') {
            playSound('workEnd');
            setTimeout(() => { setMode('break'); setTimeLeft(customBreak * 60); playSound('breakStart'); }, 1000);
          } else {
            playSound('breakEnd');
            setTimeout(() => { setMode('work'); setTimeLeft(customWork * 60); playSound('workStart'); }, 1000);
          }
        }
        return () => clearInterval(interval);
      }, [isRunning, timeLeft, mode, customWork, customBreak, playSound]);

      const toggleTimer = () => {
        if (!isRunning && timeLeft === customWork * 60 && mode === 'work') playSound('workStart');
        setIsRunning(!isRunning);
      };

      const resetTimer = () => { setIsRunning(false); setMode('work'); setTimeLeft(customWork * 60); };
      const formatTime = (s) => `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;
      const progress = mode === 'work' ? (1 - timeLeft / (customWork * 60)) * 100 : (1 - timeLeft / (customBreak * 60)) * 100;

      return (
        <div style={{ padding: '16px', height: '100%', display: 'flex', flexDirection: 'column' }}>
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '12px' }}>
            <span style={{ fontSize: '12px', color: theme.textSecondary }}>{mode === 'work' ? 'ğŸ”¥ ä½œæ¥­ä¸­' : 'â˜• ä¼‘æ†©ä¸­'}</span>
            <div style={{ display: 'flex', gap: '4px', alignItems: 'center' }}>
              <input type="number" value={customWork} onChange={(e) => { setCustomWork(Number(e.target.value)); if (!isRunning && mode === 'work') setTimeLeft(Number(e.target.value) * 60); }} style={{ width: '36px', padding: '2px 4px', fontSize: '11px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '4px', color: theme.text, textAlign: 'center' }} />
              <span style={{ fontSize: '11px', color: theme.textSecondary }}>/</span>
              <input type="number" value={customBreak} onChange={(e) => { setCustomBreak(Number(e.target.value)); if (!isRunning && mode === 'break') setTimeLeft(Number(e.target.value) * 60); }} style={{ width: '36px', padding: '2px 4px', fontSize: '11px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '4px', color: theme.text, textAlign: 'center' }} />
              <span style={{ fontSize: '11px', color: theme.textSecondary }}>åˆ†</span>
            </div>
          </div>
          <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
            <div style={{ fontSize: '36px', fontWeight: '600', fontFamily: 'monospace', color: mode === 'work' ? theme.accent : theme.success }}>{formatTime(timeLeft)}</div>
          </div>
          <div style={{ height: '4px', background: theme.bgTertiary, borderRadius: '2px', marginBottom: '12px', overflow: 'hidden' }}>
            <div style={{ height: '100%', width: `${progress}%`, background: mode === 'work' ? theme.accent : theme.success, transition: 'width 1s linear' }} />
          </div>
          <div style={{ display: 'flex', gap: '8px', justifyContent: 'center' }}>
            <button onClick={toggleTimer} style={{ padding: '8px 20px', background: isRunning ? theme.warning : theme.accent, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '6px', fontSize: '13px' }}>
              {isRunning ? <Icons.Pause /> : <Icons.Play />}{isRunning ? 'ä¸€æ™‚åœæ­¢' : 'ã‚¹ã‚¿ãƒ¼ãƒˆ'}
            </button>
            <button onClick={resetTimer} style={{ padding: '8px 12px', background: theme.bgTertiary, color: theme.text, border: `1px solid ${theme.border}`, borderRadius: '6px', cursor: 'pointer', display: 'flex', alignItems: 'center' }}><Icons.RotateCcw /></button>
          </div>
        </div>
      );
    };

    // ==================== ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ ====================
    const RemindersWidget = ({ reminders, setReminders, theme }) => {
      const [newReminder, setNewReminder] = useState('');
      const addReminder = () => { if (newReminder.trim()) { setReminders([...reminders, { id: Date.now(), text: newReminder, done: false }]); setNewReminder(''); } };

      return (
        <div style={{ padding: '12px', height: '100%', display: 'flex', flexDirection: 'column' }}>
          <div style={{ display: 'flex', gap: '8px', marginBottom: '10px' }}>
            <input type="text" value={newReminder} onChange={(e) => setNewReminder(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && addReminder()} placeholder="å¿˜ã‚Œã¡ã‚ƒã„ã‘ãªã„ã“ã¨..." style={{ flex: 1, padding: '8px 12px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '13px', outline: 'none' }} />
            <button onClick={addReminder} style={{ padding: '8px 12px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer' }}><Icons.Plus /></button>
          </div>
          <div style={{ flex: 1, overflow: 'auto' }}>
            {reminders.map(r => (
              <div key={r.id} style={{ display: 'flex', alignItems: 'center', gap: '8px', padding: '8px', marginBottom: '4px', background: r.done ? 'transparent' : theme.highlight, borderRadius: '6px', opacity: r.done ? 0.5 : 1 }}>
                <button onClick={() => setReminders(reminders.map(x => x.id === r.id ? {...x, done: !x.done} : x))} style={{ width: '20px', height: '20px', borderRadius: '4px', border: `2px solid ${r.done ? theme.success : theme.border}`, background: r.done ? theme.success : 'transparent', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', flexShrink: 0 }}>{r.done && <Icons.Check />}</button>
                <span style={{ flex: 1, fontSize: '13px', color: theme.text, textDecoration: r.done ? 'line-through' : 'none' }}>{r.text}</span>
                <button onClick={() => setReminders(reminders.filter(x => x.id !== r.id))} style={{ background: 'none', border: 'none', color: theme.textSecondary, cursor: 'pointer', padding: '4px', opacity: 0.6 }}><Icons.X /></button>
              </div>
            ))}
          </div>
        </div>
      );
    };

    // ==================== ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆé¡ ====================
    const TodayProgressWidget = ({ progress, theme }) => {
      // ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã§æ—¥ä»˜ã‚’å–å¾—
      const now = new Date();
      const today = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
      const todayProgress = progress[today] || 0;
      const goal = 2000;
      return (
        <div style={{ padding: '16px', height: '100%', display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>
          <div style={{ textAlign: 'center', marginBottom: '12px' }}>
            <div style={{ fontSize: '28px', fontWeight: '600', color: theme.accent, whiteSpace: 'nowrap' }}>{todayProgress.toLocaleString()} å­—</div>
            <div style={{ fontSize: '12px', color: theme.textSecondary, whiteSpace: 'nowrap' }}>ç›®æ¨™: {goal.toLocaleString()} å­—</div>
          </div>
          <div style={{ height: '8px', background: theme.bgTertiary, borderRadius: '4px', overflow: 'hidden' }}>
            <div style={{ height: '100%', width: `${Math.min((todayProgress / goal) * 100, 100)}%`, background: todayProgress >= goal ? theme.success : theme.accent, transition: 'width 0.3s' }} />
          </div>
        </div>
      );
    };

    const WeeklyChartWidget = ({ progress, theme }) => {
      const days = [];
      for (let i = 6; i >= 0; i--) {
        const date = new Date(); date.setDate(date.getDate() - i);
        // ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã§æ—¥ä»˜ã‚­ãƒ¼ã‚’ç”Ÿæˆ
        const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        days.push({ label: ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'][date.getDay()], value: progress[key] || 0, isToday: i === 0 });
      }
      const maxValue = Math.max(...days.map(d => d.value), 1000);
      const maxBarHeight = 80; // ãƒãƒ¼ã®æœ€å¤§é«˜ã•ï¼ˆãƒ”ã‚¯ã‚»ãƒ«ï¼‰
      
      return (
        <div style={{ padding: '16px', height: '100%', display: 'flex', flexDirection: 'column' }}>
          <div style={{ fontSize: '12px', color: theme.textSecondary, marginBottom: '12px' }}>ğŸ“Š é€±é–“åŸ·ç­†é‡</div>
          <div style={{ flex: 1, display: 'flex', alignItems: 'flex-end', gap: '8px' }}>
            {days.map((d, i) => {
              const barHeight = Math.max((d.value / maxValue) * maxBarHeight, 4);
              return (
                <div key={i} style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px' }}>
                  <span style={{ fontSize: '9px', color: d.isToday ? theme.accent : theme.textSecondary, fontWeight: d.value > 0 ? '500' : '400', minHeight: '14px' }}>
                    {d.value > 0 ? d.value.toLocaleString() : ''}
                  </span>
                  <div style={{ width: '100%', height: `${barHeight}px`, background: d.isToday ? theme.accent : theme.accentLight, borderRadius: '4px 4px 0 0' }} />
                  <span style={{ fontSize: '11px', color: d.isToday ? theme.accent : theme.textSecondary, fontWeight: d.isToday ? '600' : '400' }}>{d.label}</span>
                </div>
              );
            })}
          </div>
        </div>
      );
    };

    const WeatherWidget = ({ theme }) => (
      <div style={{ width: '100%', height: '100%', overflow: 'hidden' }}>
        <iframe src="https://indify.co/widgets/live/weather/tvvsqN4o7AvPl8J62E6R" style={{ width: '100%', height: '100%', border: 'none' }} title="Weather" />
      </div>
    );

    const LinksWidget = ({ theme }) => {
      const links = [
        { name: 'Claude', url: 'https://claude.ai', color: '#d4a574' },
        { name: 'ChatGPT', url: 'https://chat.openai.com', color: '#74aa9c' },
        { name: 'ä¹—æ›æ¡ˆå†…', url: 'https://transit.yahoo.co.jp/', color: '#6366f1' },
      ];
      return (
        <div style={{ padding: '12px', display: 'flex', flexWrap: 'wrap', gap: '8px', alignItems: 'center', height: '100%' }}>
          {links.map(l => (
            <a key={l.name} href={l.url} target="_blank" rel="noopener noreferrer" style={{ padding: '10px 16px', background: l.color, color: '#fff', borderRadius: '8px', textDecoration: 'none', fontSize: '13px', fontWeight: '500', display: 'flex', alignItems: 'center', gap: '6px' }}>
              {l.name}<Icons.ExternalLink />
            </a>
          ))}
        </div>
      );
    };

    const CalendarWidget = ({ embedCode, theme }) => {
      if (!embedCode) {
        return (
          <div style={{ padding: '20px', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', color: theme.textSecondary, fontSize: '13px', textAlign: 'center' }}>
            è¨­å®šç”»é¢ã§Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®<br/>åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ã­
          </div>
        );
      }
      // iframeã®srcã‚’æŠ½å‡º
      const srcMatch = embedCode.match(/src="([^"]+)"/);
      if (!srcMatch) {
        return (
          <div style={{ padding: '20px', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', color: theme.error, fontSize: '13px' }}>
            åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ããªã„ã‚ˆ
          </div>
        );
      }
      return (
        <iframe src={srcMatch[1]} style={{ width: '100%', height: '100%', border: 'none' }} title="Calendar" />
      );
    };

    // ==================== ãƒ›ãƒ¼ãƒ  ====================
    const HomeScreen = ({ data, setData, theme }) => {
      const widgets = {
        weather: { title: 'ğŸŒ¤ï¸ å¤©æ°—', component: <WeatherWidget theme={theme} /> },
        timer: { title: 'â±ï¸ ã‚¿ã‚¤ãƒãƒ¼', component: <PomodoroTimer theme={theme} settings={data.settings} /> },
        todayProgress: { title: 'âœï¸ ä»Šæ—¥ã®åŸ·ç­†', component: <TodayProgressWidget progress={data.progress} theme={theme} /> },
        weeklyChart: { title: 'ğŸ“Š é€±é–“ã‚°ãƒ©ãƒ•', component: <WeeklyChartWidget progress={data.progress} theme={theme} /> },
        reminders: { title: 'ğŸ“Œ å¿˜ã‚Œã¡ã‚ƒã„ã‘ãªã„ã“ã¨', component: <RemindersWidget reminders={data.reminders} setReminders={(r) => setData({...data, reminders: r})} theme={theme} /> },
        links: { title: 'ğŸ”— ãƒªãƒ³ã‚¯', component: <LinksWidget theme={theme} /> },
        calendar: { title: 'ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼', component: <CalendarWidget embedCode={data.settings.calendarEmbed} theme={theme} /> },
      };
      
      const isMobileView = window.innerWidth <= 768;
      
      return (
        <div style={{ padding: isMobileView ? '16px' : '24px', height: '100%', overflow: 'auto' }}>
          <h2 style={{ fontSize: '20px', fontWeight: '600', marginBottom: '20px', color: theme.text }}>ğŸ  ãƒ›ãƒ¼ãƒ </h2>
          <div style={{ 
            display: 'grid', 
            gridTemplateColumns: isMobileView ? '1fr' : 'repeat(12, 1fr)', 
            gap: isMobileView ? '12px' : '16px', 
            gridAutoRows: isMobileView ? 'auto' : '120px' 
          }}>
            {data.widgetLayout.map(w => {
              const widget = widgets[w.id];
              if (!widget) return null;
              return (
                <div key={w.id} style={{ 
                  gridColumn: isMobileView ? 'span 1' : `span ${w.w}`, 
                  gridRow: isMobileView ? 'span 1' : `span ${w.h}`, 
                  background: theme.bgSecondary, 
                  borderRadius: '12px', 
                  border: `1px solid ${theme.border}`, 
                  overflow: 'hidden', 
                  display: 'flex', 
                  flexDirection: 'column',
                  minHeight: isMobileView ? '150px' : 'auto'
                }}>
                  <div style={{ padding: '8px 12px', borderBottom: `1px solid ${theme.border}`, fontSize: '12px', fontWeight: '500', color: theme.textSecondary, display: 'flex', alignItems: 'center', gap: '6px', flexShrink: 0 }}>
                    <Icons.GripVertical />{widget.title}
                  </div>
                  <div style={{ flex: 1, overflow: 'hidden', minHeight: 0 }}>{widget.component}</div>
                </div>
              );
            })}
          </div>
        </div>
      );
    };

    // ==================== ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚¨ãƒ‡ã‚£ã‚¿ ====================
    const OutlineEditor = ({ content, onChange, theme }) => {
      const [collapsed, setCollapsed] = useState({});
      const [draggedId, setDraggedId] = useState(null);
      const [dragOverId, setDragOverId] = useState(null);

      const autoResize = (textarea) => {
        if (textarea) {
          textarea.style.height = 'auto';
          textarea.style.height = Math.max(60, textarea.scrollHeight) + 'px';
        }
      };

      const parseOutline = (text) => {
        if (!text) return [];
        const lines = text.split('\n');
        const sections = [];
        let current = null;
        let buffer = [];

        const save = () => {
          if (current) {
            current.content = buffer.join('\n');
            sections.push(current);
          }
        };

        lines.forEach((line, i) => {
          const h1 = line.match(/^# (.*)$/);
          const h2 = line.match(/^## (.*)$/);
          const h3 = line.match(/^### (.*)$/);
          if (h1 || h2 || h3) {
            save();
            current = { id: `section-${sections.length}`, level: h1 ? 1 : h2 ? 2 : 3, title: h1?.[1] || h2?.[1] || h3?.[1] || '', content: '' };
            buffer = [];
          } else {
            buffer.push(line);
          }
        });
        save();

        if (sections.length === 0 && text.trim()) {
          sections.push({ id: 'section-0', level: 0, title: '', content: text });
        }
        return sections;
      };

      const sections = parseOutline(content);

      const rebuildContent = (sectionList) => {
        const newContent = sectionList.map(s => {
          if (s.level === 0) return s.content;
          const prefix = '#'.repeat(s.level) + ' ' + s.title;
          return s.content ? prefix + '\n' + s.content : prefix;
        }).join('\n');
        onChange(newContent);
      };

      const updateSection = (sectionId, field, value) => {
        const newSections = sections.map(s => s.id === sectionId ? { ...s, [field]: value } : s);
        rebuildContent(newSections);
      };

      const addSectionAfter = (afterId, level) => {
        const idx = sections.findIndex(s => s.id === afterId);
        const newSection = { id: `section-new-${Date.now()}`, level, title: 'æ–°ã—ã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³', content: '' };
        const newSections = [...sections];
        newSections.splice(idx + 1, 0, newSection);
        rebuildContent(newSections);
      };

      const addSection = (level) => {
        const newSection = { id: `section-new-${Date.now()}`, level, title: 'æ–°ã—ã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³', content: '' };
        rebuildContent([...sections, newSection]);
      };

      const deleteSection = (sectionId) => {
        if (confirm('ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          rebuildContent(sections.filter(s => s.id !== sectionId));
        }
      };

      const handleDragStart = (e, id) => { setDraggedId(id); e.dataTransfer.effectAllowed = 'move'; };
      const handleDragOver = (e, id) => { e.preventDefault(); if (id !== draggedId) setDragOverId(id); };
      const handleDragLeave = () => { setDragOverId(null); };
      const handleDrop = (e, targetId) => {
        e.preventDefault();
        if (draggedId && targetId && draggedId !== targetId) {
          const draggedIdx = sections.findIndex(s => s.id === draggedId);
          const targetIdx = sections.findIndex(s => s.id === targetId);
          if (draggedIdx !== -1 && targetIdx !== -1) {
            const newSections = [...sections];
            const [dragged] = newSections.splice(draggedIdx, 1);
            newSections.splice(targetIdx, 0, dragged);
            rebuildContent(newSections);
          }
        }
        setDraggedId(null);
        setDragOverId(null);
      };
      const handleDragEnd = () => { setDraggedId(null); setDragOverId(null); };

      const hasChildren = (idx) => idx + 1 < sections.length && sections[idx + 1].level > sections[idx].level;
      const isHidden = (idx) => {
        const s = sections[idx];
        for (let i = idx - 1; i >= 0; i--) {
          const prev = sections[i];
          if (prev.level < s.level && prev.level > 0 && collapsed[prev.id]) return true;
          if (prev.level > 0 && prev.level < s.level) break;
        }
        return false;
      };
      const toggleCollapse = (id) => { setCollapsed(prev => ({ ...prev, [id]: !prev[id] })); };

      if (sections.length === 0 || (sections.length === 1 && sections[0].level === 0 && !sections[0].content?.trim())) {
        return (
          <div style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>
            <div style={{ padding: '8px 16px', borderBottom: `1px solid ${theme.border}`, display: 'flex', gap: '8px', alignItems: 'center', background: theme.bgSecondary }}>
              <span style={{ fontSize: '11px', color: theme.textSecondary }}>ğŸ’¡ # å¤§é …ç›® / ## ä¸­é …ç›® / ### å°é …ç›® ã§éšå±¤åŒ–</span>
              <div style={{ flex: 1 }} />
              <button onClick={() => addSection(1)} style={{ padding: '4px 8px', fontSize: '11px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>+ å¤§é …ç›®</button>
              <button onClick={() => addSection(2)} style={{ padding: '4px 8px', fontSize: '11px', background: theme.bgTertiary, color: theme.text, border: `1px solid ${theme.border}`, borderRadius: '4px', cursor: 'pointer' }}>+ ä¸­é …ç›®</button>
            </div>
            <textarea value={content || ''} onChange={(e) => onChange(e.target.value)} placeholder="ã“ã“ã«ãƒ—ãƒ­ãƒƒãƒˆã‚’æ›¸ã..." style={{ flex: 1, padding: '20px 24px', background: theme.bg, border: 'none', outline: 'none', resize: 'none', fontSize: '15px', lineHeight: '2', color: theme.text, fontFamily: '"Noto Serif JP", serif' }} />
          </div>
        );
      }

      return (
        <div style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>
          <div style={{ padding: '8px 16px', borderBottom: `1px solid ${theme.border}`, display: 'flex', gap: '8px', alignItems: 'center', background: theme.bgSecondary, flexShrink: 0, flexWrap: 'wrap' }}>
            <button onClick={() => addSection(1)} style={{ padding: '4px 10px', fontSize: '11px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>+ å¤§é …ç›®</button>
            <button onClick={() => addSection(2)} style={{ padding: '4px 10px', fontSize: '11px', background: theme.bgTertiary, color: theme.text, border: `1px solid ${theme.border}`, borderRadius: '4px', cursor: 'pointer' }}>+ ä¸­é …ç›®</button>
            <button onClick={() => addSection(3)} style={{ padding: '4px 10px', fontSize: '11px', background: theme.bgTertiary, color: theme.text, border: `1px solid ${theme.border}`, borderRadius: '4px', cursor: 'pointer' }}>+ å°é …ç›®</button>
            <div style={{ flex: 1 }} />
            <span style={{ fontSize: '10px', color: theme.textSecondary }}>â¬ ãƒ‰ãƒ©ãƒƒã‚°ã§ä¸¦ã³æ›¿ãˆ</span>
            <button onClick={() => {
              const allIds = sections.filter(s => s.level > 0).map(s => s.id);
              const allCollapsed = allIds.every(id => collapsed[id]);
              const newCollapsed = {};
              allIds.forEach(id => { newCollapsed[id] = !allCollapsed; });
              setCollapsed(newCollapsed);
            }} style={{ padding: '4px 10px', fontSize: '11px', background: theme.bgTertiary, color: theme.textSecondary, border: `1px solid ${theme.border}`, borderRadius: '4px', cursor: 'pointer' }}>
              {Object.values(collapsed).filter(Boolean).length > 0 ? 'ğŸ“‚ ã™ã¹ã¦é–‹ã' : 'ğŸ“ ã™ã¹ã¦é–‰ã˜ã‚‹'}
            </button>
          </div>

          <div style={{ flex: 1, overflow: 'auto', padding: '12px', background: theme.bg }}>
            {sections.map((s, idx) => {
              if (isHidden(idx)) return null;
              const indent = s.level > 0 ? (s.level - 1) * 24 : 0;
              const isCollapsedItem = collapsed[s.id];
              const isDragging = draggedId === s.id;
              const isDragOver = dragOverId === s.id;

              if (s.level === 0) {
                return (
                  <div key={s.id} style={{ marginBottom: '8px' }}>
                    <textarea value={s.content} onChange={(e) => { updateSection(s.id, 'content', e.target.value); autoResize(e.target); }} ref={(el) => el && autoResize(el)} style={{ width: '100%', minHeight: '60px', padding: '12px', background: theme.bgSecondary, border: `1px solid ${theme.border}`, borderRadius: '8px', color: theme.text, fontSize: '14px', lineHeight: '1.8', resize: 'none', outline: 'none', fontFamily: '"Noto Serif JP", serif', overflow: 'hidden' }} />
                  </div>
                );
              }

              return (
                <div key={s.id} draggable onDragStart={(e) => handleDragStart(e, s.id)} onDragOver={(e) => handleDragOver(e, s.id)} onDragLeave={handleDragLeave} onDrop={(e) => handleDrop(e, s.id)} onDragEnd={handleDragEnd} style={{ marginLeft: indent, marginBottom: '6px', opacity: isDragging ? 0.5 : 1, transform: isDragOver ? 'translateY(4px)' : 'none', transition: 'transform 0.15s, opacity 0.15s' }}>
                  {isDragOver && <div style={{ height: '3px', background: theme.accent, borderRadius: '2px', marginBottom: '4px' }} />}
                  <div style={{ background: theme.bgSecondary, borderRadius: '8px', border: `1px solid ${isDragOver ? theme.accent : theme.border}`, borderLeft: s.level === 1 ? `4px solid ${theme.accent}` : s.level === 2 ? `4px solid ${theme.accentLight}` : `4px solid ${theme.border}`, overflow: 'hidden' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '6px', padding: '8px 12px', background: isCollapsedItem ? theme.bgTertiary : 'transparent', borderBottom: isCollapsedItem ? 'none' : `1px solid ${theme.border}` }}>
                      <span style={{ cursor: 'grab', color: theme.textSecondary, display: 'flex', padding: '2px' }} title="ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•"><Icons.GripVertical /></span>
                      <span onClick={() => toggleCollapse(s.id)} style={{ color: theme.textSecondary, display: 'flex', transform: isCollapsedItem ? 'rotate(0deg)' : 'rotate(90deg)', transition: 'transform 0.2s', cursor: 'pointer', padding: '2px' }}><Icons.ChevronRight /></span>
                      <input type="text" value={s.title} onChange={(e) => updateSection(s.id, 'title', e.target.value)} placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›..." style={{ flex: 1, background: 'transparent', border: 'none', outline: 'none', fontSize: s.level === 1 ? '15px' : '14px', fontWeight: s.level === 1 ? '600' : '500', color: s.level === 1 ? theme.accent : theme.text, padding: '4px' }} />
                      {isCollapsedItem && s.content.trim() && <span style={{ fontSize: '11px', color: theme.textSecondary, maxWidth: '150px', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{s.content.trim().substring(0, 25)}...</span>}
                      <div style={{ display: 'flex', gap: '2px' }}>
                        <button onClick={() => addSectionAfter(s.id, s.level)} style={{ padding: '2px 6px', fontSize: '10px', background: theme.bgTertiary, color: theme.textSecondary, border: `1px solid ${theme.border}`, borderRadius: '3px', cursor: 'pointer' }} title="ä¸‹ã«åŒãƒ¬ãƒ™ãƒ«ã‚’è¿½åŠ ">+</button>
                        <button onClick={() => deleteSection(s.id)} style={{ padding: '2px 6px', fontSize: '10px', background: 'transparent', color: theme.textSecondary, border: 'none', borderRadius: '3px', cursor: 'pointer', opacity: 0.6 }} title="å‰Šé™¤"><Icons.Trash /></button>
                      </div>
                    </div>
                    {!isCollapsedItem && (
                      <textarea value={s.content} onChange={(e) => { updateSection(s.id, 'content', e.target.value); autoResize(e.target); }} ref={(el) => el && autoResize(el)} placeholder="å†…å®¹ã‚’å…¥åŠ›..." style={{ width: '100%', minHeight: '60px', padding: '12px', background: 'transparent', border: 'none', outline: 'none', color: theme.text, fontSize: '14px', lineHeight: '1.8', resize: 'none', overflow: 'hidden', fontFamily: '"Noto Serif JP", serif' }} />
                    )}
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      );
    };

    // ==================== æ—¥å¸¸ãƒ¡ãƒ¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ====================
    const DailySection = ({ data, setData, theme }) => {
      const [selectedMemo, setSelectedMemo] = useState(null);
      const [editingId, setEditingId] = useState(null);
      const [tagFilter, setTagFilter] = useState('all');

      const addMemo = () => {
        const newMemo = { id: `daily-${Date.now()}`, title: 'æ–°ã—ã„ãƒ¡ãƒ¢', content: '', tags: [], createdAt: new Date().toISOString() };
        setData({ ...data, daily: [newMemo, ...data.daily] });
        setSelectedMemo(newMemo);
      };

      const updateMemo = (id, field, value) => {
        setData({ ...data, daily: data.daily.map(m => m.id === id ? { ...m, [field]: value } : m) });
        if (selectedMemo?.id === id) setSelectedMemo({ ...selectedMemo, [field]: value });
      };

      const deleteMemo = (id) => {
        if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          setData({ ...data, daily: data.daily.filter(m => m.id !== id) });
          if (selectedMemo?.id === id) setSelectedMemo(null);
        }
      };

      const addTagToMemo = (memoId, tag) => {
        const memo = data.daily.find(m => m.id === memoId);
        if (memo && !memo.tags.includes(tag)) {
          updateMemo(memoId, 'tags', [...memo.tags, tag]);
        }
      };

      const removeTagFromMemo = (memoId, tag) => {
        const memo = data.daily.find(m => m.id === memoId);
        if (memo) {
          updateMemo(memoId, 'tags', memo.tags.filter(t => t !== tag));
        }
      };

      // ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
      const filteredMemos = tagFilter === 'all' 
        ? data.daily 
        : data.daily.filter(m => m.tags.includes(tagFilter));

      // ä½¿ç”¨ä¸­ã®ã‚¿ã‚°ã‚’åé›†
      const usedTags = [...new Set(data.daily.flatMap(m => m.tags))];

      const isMobileView = window.innerWidth <= 768;

      return (
        <div style={{ display: 'flex', height: '100%', flexDirection: isMobileView ? 'column' : 'row' }}>
          {/* ãƒªã‚¹ãƒˆï¼ˆãƒ¢ãƒã‚¤ãƒ«ã§é¸æŠæ¸ˆã¿ã®å ´åˆã¯éè¡¨ç¤ºï¼‰ */}
          {(!isMobileView || !selectedMemo) && (
            <div style={{ width: isMobileView ? '100%' : '300px', borderRight: isMobileView ? 'none' : `1px solid ${theme.border}`, display: 'flex', flexDirection: 'column', background: theme.bgSecondary, flex: isMobileView ? 1 : 'none' }}>
              <div style={{ padding: '16px', borderBottom: `1px solid ${theme.border}` }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                  <span style={{ fontWeight: '600' }}>ğŸ—’ï¸ æ—¥å¸¸ãƒ¡ãƒ¢</span>
                  <button onClick={addMemo} style={{ padding: '6px 12px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '12px', display: 'flex', alignItems: 'center', gap: '4px' }}><Icons.Plus /> è¿½åŠ </button>
                </div>
                {/* ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */}
                <div style={{ display: 'flex', gap: '4px', flexWrap: 'wrap' }}>
                  <button onClick={() => setTagFilter('all')} style={{ padding: '4px 8px', fontSize: '10px', background: tagFilter === 'all' ? theme.accent : theme.bgTertiary, color: tagFilter === 'all' ? '#fff' : theme.textSecondary, border: 'none', borderRadius: '4px', cursor: 'pointer' }}>All</button>
                  {usedTags.map(tag => (
                    <button key={tag} onClick={() => setTagFilter(tag)} style={{ padding: '4px 8px', fontSize: '10px', background: tagFilter === tag ? theme.accent : theme.bgTertiary, color: tagFilter === tag ? '#fff' : theme.textSecondary, border: 'none', borderRadius: '4px', cursor: 'pointer' }}>{tag}</button>
                  ))}
                </div>
              </div>
              <div style={{ flex: 1, overflow: 'auto', padding: '8px' }}>
                {filteredMemos.map(memo => (
                  <div key={memo.id} onClick={() => setSelectedMemo(memo)} style={{ padding: '12px', marginBottom: '4px', borderRadius: '8px', cursor: 'pointer', background: selectedMemo?.id === memo.id ? theme.highlight : 'transparent', border: `1px solid ${selectedMemo?.id === memo.id ? theme.accent : 'transparent'}` }}>
                    {editingId === memo.id ? (
                      <input type="text" value={memo.title} onChange={(e) => updateMemo(memo.id, 'title', e.target.value)} onBlur={() => setEditingId(null)} onKeyDown={(e) => e.key === 'Enter' && setEditingId(null)} autoFocus style={{ width: '100%', background: theme.bg, border: `1px solid ${theme.accent}`, borderRadius: '4px', padding: '4px 8px', color: theme.text, fontSize: '13px', outline: 'none', boxSizing: 'border-box' }} />
                    ) : (
                      <div onDoubleClick={() => setEditingId(memo.id)} style={{ fontWeight: '500', fontSize: '13px', marginBottom: '4px' }}>{memo.title}</div>
                    )}
                    <div style={{ display: 'flex', gap: '4px', flexWrap: 'wrap' }}>
                      {memo.tags.map(tag => (
                        <span key={tag} style={{ fontSize: '10px', padding: '2px 6px', background: theme.bgTertiary, borderRadius: '4px', color: theme.textSecondary }}>{tag}</span>
                      ))}
                    </div>
                  </div>
                ))}
                {filteredMemos.length === 0 && <div style={{ textAlign: 'center', color: theme.textSecondary, padding: '40px 20px', fontSize: '13px' }}>{tagFilter === 'all' ? 'ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“' : `ã€Œ${tagFilter}ã€ã‚¿ã‚°ã®ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“`}<br/>ã€Œ+ è¿½åŠ ã€ã§ä½œæˆã—ã¦ã­</div>}
              </div>
            </div>
          )}

          {/* ã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆãƒ¢ãƒã‚¤ãƒ«ã§æœªé¸æŠã®å ´åˆã¯éè¡¨ç¤ºï¼‰ */}
          {(!isMobileView || selectedMemo) && (
            <div style={{ flex: 1, display: 'flex', flexDirection: 'column', background: theme.bg }}>
              {selectedMemo ? (
                <>
                  <div style={{ padding: '12px 16px', borderBottom: `1px solid ${theme.border}`, display: 'flex', alignItems: 'center', gap: '12px', background: theme.bgSecondary, flexWrap: 'wrap' }}>
                    {isMobileView && (
                      <button onClick={() => setSelectedMemo(null)} style={{ padding: '6px 10px', background: theme.bgTertiary, color: theme.text, border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '12px' }}>â† æˆ»ã‚‹</button>
                    )}
                    {editingId === `title-${selectedMemo.id}` ? (
                      <input type="text" value={selectedMemo.title} onChange={(e) => updateMemo(selectedMemo.id, 'title', e.target.value)} onBlur={() => setEditingId(null)} onKeyDown={(e) => e.key === 'Enter' && setEditingId(null)} autoFocus style={{ flex: 1, fontWeight: '500', fontSize: '15px', background: theme.bg, border: `1px solid ${theme.accent}`, borderRadius: '4px', padding: '4px 8px', color: theme.text, outline: 'none', minWidth: '100px', boxSizing: 'border-box' }} />
                    ) : (
                      <span onDoubleClick={() => setEditingId(`title-${selectedMemo.id}`)} style={{ fontWeight: '500', fontSize: '15px', cursor: 'text', flex: 1 }}>{selectedMemo.title}</span>
                    )}
                    <button onClick={() => deleteMemo(selectedMemo.id)} style={{ padding: '6px 12px', background: theme.error, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '12px' }}>å‰Šé™¤</button>
                  </div>
                  {/* ã‚¿ã‚° */}
                  <div style={{ padding: '12px 16px', borderBottom: `1px solid ${theme.border}`, display: 'flex', gap: '8px', alignItems: 'center', flexWrap: 'wrap', background: theme.bgSecondary }}>
                    <Icons.Tag />
                    {selectedMemo.tags.map(tag => (
                      <span key={tag} style={{ fontSize: '11px', padding: '4px 8px', background: theme.accent, color: '#fff', borderRadius: '4px', display: 'flex', alignItems: 'center', gap: '4px' }}>
                        {tag}
                        <button onClick={() => removeTagFromMemo(selectedMemo.id, tag)} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', padding: 0, display: 'flex' }}><Icons.X /></button>
                      </span>
                    ))}
                    <select value="" onChange={(e) => { if (e.target.value) addTagToMemo(selectedMemo.id, e.target.value); }} style={{ padding: '4px 8px', fontSize: '11px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '4px', color: theme.text, cursor: 'pointer' }}>
                      <option value="">+ ã‚¿ã‚°è¿½åŠ </option>
                      {(data.dailyTags || ['ä»•äº‹', 'è²·ã„ç‰©', 'ã‚¢ã‚¤ãƒ‡ã‚¢', 'æ—¥è¨˜']).filter(t => !selectedMemo.tags.includes(t)).map(t => <option key={t} value={t}>{t}</option>)}
                    </select>
                  </div>
                  <textarea value={selectedMemo.content} onChange={(e) => updateMemo(selectedMemo.id, 'content', e.target.value)} placeholder="ãƒ¡ãƒ¢ã‚’å…¥åŠ›..." style={{ flex: 1, padding: '20px 24px', background: 'transparent', border: 'none', outline: 'none', resize: 'none', fontSize: '14px', lineHeight: '1.8', color: theme.text, fontFamily: '"Noto Serif JP", serif' }} />
                </>
              ) : (
                <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: theme.textSecondary }}>ãƒ¡ãƒ¢ã‚’é¸æŠã—ã¦ã­</div>
              )}
            </div>
          )}
        </div>
      );
    };

    // ==================== Inputã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ & è‡ªå‹•å®Œäº†ï¼‰ ====================
    const InputSection = ({ data, setData, theme }) => {
      const [selectedInput, setSelectedInput] = useState(null);
      const [editingId, setEditingId] = useState(null);
      const [filter, setFilter] = useState('all'); // all, reading, finished
      const [tagFilter, setTagFilter] = useState('all');
      const [showTagSelector, setShowTagSelector] = useState(false);

      const addInput = () => {
        const newInput = {
          id: `input-${Date.now()}`,
          title: 'æ–°ã—ã„ä½œå“',
          tags: [],
          startDate: '',
          finishDate: '',
          content: '',
          status: 'reading', // reading | finished
          createdAt: new Date().toISOString()
        };
        setData({ ...data, input: [newInput, ...data.input] });
        setSelectedInput(newInput);
      };

      const updateInput = (id, field, value) => {
        let updates = { [field]: value };
        
        // Finishæ—¥ä»˜ãŒå…¥åŠ›ã•ã‚ŒãŸã‚‰è‡ªå‹•çš„ã«å®Œäº†ã«
        if (field === 'finishDate' && value) {
          updates.status = 'finished';
        }
        
        const newInput = data.input.map(i => i.id === id ? { ...i, ...updates } : i);
        setData({ ...data, input: newInput });
        if (selectedInput?.id === id) setSelectedInput({ ...selectedInput, ...updates });
      };

      const deleteInput = (id) => {
        if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          setData({ ...data, input: data.input.filter(i => i.id !== id) });
          if (selectedInput?.id === id) setSelectedInput(null);
        }
      };

      const addTagToInput = (inputId, tag) => {
        const input = data.input.find(i => i.id === inputId);
        if (input && !input.tags.includes(tag)) {
          updateInput(inputId, 'tags', [...input.tags, tag]);
        }
      };

      const removeTagFromInput = (inputId, tag) => {
        const input = data.input.find(i => i.id === inputId);
        if (input) {
          updateInput(inputId, 'tags', input.tags.filter(t => t !== tag));
        }
      };

      const filteredInputs = data.input.filter(i => {
        if (filter === 'reading' && i.status !== 'reading') return false;
        if (filter === 'finished' && i.status !== 'finished') return false;
        if (tagFilter !== 'all' && !i.tags.includes(tagFilter)) return false;
        return true;
      });

      // inputTagsãŒãªã„å ´åˆã®åˆæœŸåŒ–
      const inputTags = data.inputTags || ['å°èª¬', 'æ¼«ç”»', 'Audible', 'æ˜ ç”»', 'ãƒ‰ãƒ©ãƒ', 'ã‚¢ãƒ‹ãƒ¡', 'YouTube'];

      const isMobileView = window.innerWidth <= 768;

      return (
        <div style={{ display: 'flex', height: '100%', flexDirection: isMobileView ? 'column' : 'row' }} onClick={() => setShowTagSelector(false)}>
          {/* ãƒªã‚¹ãƒˆï¼ˆãƒ¢ãƒã‚¤ãƒ«ã§é¸æŠæ¸ˆã¿ã®å ´åˆã¯éè¡¨ç¤ºï¼‰ */}
          {(!isMobileView || !selectedInput) && (
            <div style={{ width: isMobileView ? '100%' : '320px', borderRight: isMobileView ? 'none' : `1px solid ${theme.border}`, display: 'flex', flexDirection: 'column', background: theme.bgSecondary, flex: isMobileView ? 1 : 'none' }}>
              <div style={{ padding: '16px', borderBottom: `1px solid ${theme.border}` }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                  <span style={{ fontWeight: '600' }}>ğŸ“– Input</span>
                  <button onClick={addInput} style={{ padding: '6px 12px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '12px', display: 'flex', alignItems: 'center', gap: '4px' }}><Icons.Plus /> è¿½åŠ </button>
                </div>
                {/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */}
                <div style={{ display: 'flex', gap: '4px', marginBottom: '8px' }}>
                  {['all', 'reading', 'finished'].map(f => (
                    <button key={f} onClick={() => setFilter(f)} style={{ flex: 1, padding: '6px', fontSize: '11px', background: filter === f ? theme.accent : theme.bgTertiary, color: filter === f ? '#fff' : theme.textSecondary, border: 'none', borderRadius: '4px', cursor: 'pointer' }}>
                      {f === 'all' ? 'ã™ã¹ã¦' : f === 'reading' ? 'é€²è¡Œä¸­' : 'å®Œäº†'}
                    </button>
                  ))}
                </div>
                {/* ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */}
                <div style={{ display: 'flex', gap: '4px', flexWrap: 'wrap' }}>
                  <button onClick={() => setTagFilter('all')} style={{ padding: '4px 8px', fontSize: '10px', background: tagFilter === 'all' ? theme.accent : theme.bgTertiary, color: tagFilter === 'all' ? '#fff' : theme.textSecondary, border: 'none', borderRadius: '4px', cursor: 'pointer' }}>All</button>
                  {inputTags.map(tag => (
                    <button key={tag} onClick={() => setTagFilter(tag)} style={{ padding: '4px 8px', fontSize: '10px', background: tagFilter === tag ? theme.accent : theme.bgTertiary, color: tagFilter === tag ? '#fff' : theme.textSecondary, border: 'none', borderRadius: '4px', cursor: 'pointer' }}>{tag}</button>
                  ))}
                </div>
              </div>
              <div style={{ flex: 1, overflow: 'auto', padding: '8px' }}>
                {filteredInputs.map(input => (
                  <div key={input.id} onClick={() => setSelectedInput(input)} style={{ padding: '12px', marginBottom: '4px', borderRadius: '8px', cursor: 'pointer', background: selectedInput?.id === input.id ? theme.highlight : 'transparent', border: `1px solid ${selectedInput?.id === input.id ? theme.accent : 'transparent'}` }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '4px' }}>
                      {editingId === input.id ? (
                        <input type="text" value={input.title} onChange={(e) => updateInput(input.id, 'title', e.target.value)} onBlur={() => setEditingId(null)} onKeyDown={(e) => e.key === 'Enter' && setEditingId(null)} autoFocus onClick={(e) => e.stopPropagation()} style={{ flex: 1, background: theme.bg, border: `1px solid ${theme.accent}`, borderRadius: '4px', padding: '2px 6px', color: theme.text, fontSize: '13px', outline: 'none', boxSizing: 'border-box' }} />
                      ) : (
                        <span onDoubleClick={(e) => { e.stopPropagation(); setEditingId(input.id); }} style={{ flex: 1, fontWeight: '500', fontSize: '13px' }}>{input.title}</span>
                      )}
                      <span style={{ fontSize: '10px', padding: '2px 6px', background: input.status === 'finished' ? theme.success : theme.warning, color: '#fff', borderRadius: '4px' }}>
                        {input.status === 'finished' ? 'å®Œäº†' : 'é€²è¡Œä¸­'}
                      </span>
                    </div>
                    {/* ã‚¿ã‚°è¡¨ç¤º */}
                    <div style={{ display: 'flex', gap: '4px', flexWrap: 'wrap', marginBottom: '4px' }}>
                      {input.tags.map(tag => (
                        <span key={tag} style={{ fontSize: '10px', padding: '2px 6px', background: theme.bgTertiary, borderRadius: '4px', color: theme.textSecondary }}>{tag}</span>
                      ))}
                    </div>
                    <div style={{ fontSize: '11px', color: theme.textSecondary }}>
                      {input.startDate && `START: ${input.startDate}`}
                      {input.finishDate && ` â†’ FINISH: ${input.finishDate}`}
                    </div>
                  </div>
                ))}
                {filteredInputs.length === 0 && <div style={{ textAlign: 'center', color: theme.textSecondary, padding: '40px 20px', fontSize: '13px' }}>è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>}
              </div>
            </div>
          )}

          {/* ã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆãƒ¢ãƒã‚¤ãƒ«ã§æœªé¸æŠã®å ´åˆã¯éè¡¨ç¤ºï¼‰ */}
          {(!isMobileView || selectedInput) && (
            <div style={{ flex: 1, display: 'flex', flexDirection: 'column', background: theme.bg }}>
              {selectedInput ? (
                <>
                  <div style={{ padding: '12px 16px', borderBottom: `1px solid ${theme.border}`, display: 'flex', alignItems: 'center', gap: '12px', background: theme.bgSecondary, flexWrap: 'wrap' }}>
                    {isMobileView && (
                      <button onClick={() => setSelectedInput(null)} style={{ padding: '6px 10px', background: theme.bgTertiary, color: theme.text, border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '12px' }}>â† æˆ»ã‚‹</button>
                    )}
                    {editingId === `title-${selectedInput.id}` ? (
                      <input type="text" value={selectedInput.title} onChange={(e) => updateInput(selectedInput.id, 'title', e.target.value)} onBlur={() => setEditingId(null)} onKeyDown={(e) => e.key === 'Enter' && setEditingId(null)} autoFocus style={{ flex: 1, fontWeight: '500', fontSize: '15px', background: theme.bg, border: `1px solid ${theme.accent}`, borderRadius: '4px', padding: '4px 8px', color: theme.text, outline: 'none', minWidth: '100px', boxSizing: 'border-box' }} />
                    ) : (
                      <span onDoubleClick={() => setEditingId(`title-${selectedInput.id}`)} style={{ fontWeight: '500', fontSize: '15px', cursor: 'text', flex: 1 }}>{selectedInput.title}</span>
                    )}
                    <select value={selectedInput.status} onChange={(e) => updateInput(selectedInput.id, 'status', e.target.value)} style={{ padding: '6px 12px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '12px' }}>
                      <option value="reading">é€²è¡Œä¸­</option>
                      <option value="finished">å®Œäº†</option>
                    </select>
                    <button onClick={() => deleteInput(selectedInput.id)} style={{ padding: '6px 12px', background: theme.error, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '12px' }}>å‰Šé™¤</button>
                  </div>
                  {/* ã‚¿ã‚° */}
                  <div style={{ padding: '12px 16px', borderBottom: `1px solid ${theme.border}`, display: 'flex', gap: '8px', alignItems: 'center', flexWrap: 'wrap', background: theme.bgSecondary }}>
                    <Icons.Tag />
                    {selectedInput.tags.map(tag => (
                      <span key={tag} style={{ fontSize: '11px', padding: '4px 8px', background: theme.accent, color: '#fff', borderRadius: '4px', display: 'flex', alignItems: 'center', gap: '4px' }}>
                        {tag}
                        <button onClick={() => removeTagFromInput(selectedInput.id, tag)} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', padding: 0, display: 'flex' }}><Icons.X /></button>
                      </span>
                    ))}
                    <div style={{ position: 'relative' }} onClick={(e) => e.stopPropagation()}>
                      <button onClick={() => setShowTagSelector(!showTagSelector)} style={{ fontSize: '11px', padding: '4px 8px', background: theme.bgTertiary, color: theme.textSecondary, border: `1px dashed ${theme.border}`, borderRadius: '4px', cursor: 'pointer' }}>+ ã‚¿ã‚°è¿½åŠ </button>
                      {showTagSelector && (
                        <div style={{ position: 'absolute', top: '100%', left: 0, background: theme.bgSecondary, border: `1px solid ${theme.border}`, borderRadius: '6px', padding: '8px', zIndex: 100, minWidth: '120px', boxShadow: '0 4px 12px rgba(0,0,0,0.2)' }}>
                          {inputTags.filter(t => !selectedInput.tags.includes(t)).map(tag => (
                            <div key={tag} onClick={() => { addTagToInput(selectedInput.id, tag); setShowTagSelector(false); }} style={{ padding: '4px 8px', fontSize: '11px', cursor: 'pointer', borderRadius: '4px', color: theme.text }} onMouseOver={(e) => e.target.style.background = theme.bgTertiary} onMouseOut={(e) => e.target.style.background = 'transparent'}>{tag}</div>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                  {/* æ—¥ä»˜ */}
                  <div style={{ padding: '16px', borderBottom: `1px solid ${theme.border}`, display: 'flex', gap: isMobileView ? '12px' : '24px', background: theme.bgSecondary, flexWrap: 'wrap' }}>
                    <div>
                      <label style={{ fontSize: '11px', color: theme.textSecondary, display: 'block', marginBottom: '4px' }}>START</label>
                      <input type="date" value={selectedInput.startDate} onChange={(e) => updateInput(selectedInput.id, 'startDate', e.target.value)} style={{ padding: '8px 12px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '13px' }} />
                    </div>
                    <div>
                      <label style={{ fontSize: '11px', color: theme.textSecondary, display: 'block', marginBottom: '4px' }}>FINISH <span style={{ fontSize: '9px', color: theme.accent }}>ï¼ˆå…¥åŠ›ã§è‡ªå‹•å®Œäº†ï¼‰</span></label>
                      <input type="date" value={selectedInput.finishDate} onChange={(e) => updateInput(selectedInput.id, 'finishDate', e.target.value)} style={{ padding: '8px 12px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '13px' }} />
                    </div>
                  </div>
                  <textarea value={selectedInput.content} onChange={(e) => updateInput(selectedInput.id, 'content', e.target.value)} placeholder="æ„Ÿæƒ³ãƒ»ãƒ¡ãƒ¢ã‚’å…¥åŠ›..." style={{ flex: 1, padding: '20px 24px', background: 'transparent', border: 'none', outline: 'none', resize: 'none', fontSize: '14px', lineHeight: '1.8', color: theme.text, fontFamily: '"Noto Serif JP", serif' }} />
                </>
              ) : (
                <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: theme.textSecondary }}>è¨˜éŒ²ã‚’é¸æŠã—ã¦ã­</div>
              )}
            </div>
          )}
        </div>
      );
    };

    // ==================== å‰µä½œã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ & ãƒã‚¿å¸³çµ±åˆï¼‰ ====================
    const CreativeSection = ({ data, setData, selectedItem, setSelectedItem, openInNewPane, theme, sidebarWidth }) => {
      const { creative } = data;
      const [editingItemId, setEditingItemId] = useState(null);
      const [editingProjectId, setEditingProjectId] = useState(null);
      const [draggedProject, setDraggedProject] = useState(null);
      const [dragOverStatus, setDragOverStatus] = useState(null);
      const [collapsedSections, setCollapsedSections] = useState(data.collapsedSections || { completed: true, onHold: true });
      const [showTagSelector, setShowTagSelector] = useState(null);
      const [activeTab, setActiveTab] = useState('works'); // 'works' | 'ideas'
      const [tagFilter, setTagFilter] = useState('all');
      const [editingIdeaId, setEditingIdeaId] = useState(null);

      const ideas = creative.ideas || [];

      const countChars = (project) => project.items.filter(i => i.type === 'chapter').reduce((sum, i) => sum + (i.content || '').replace(/[\s\n]/g, '').length, 0);
      const totalChars = () => [...creative.inProgress, ...creative.completed, ...creative.onHold].reduce((sum, p) => sum + countChars(p), 0);

      // ä½¿ç”¨ä¸­ã®ã‚¿ã‚°ã‚’åé›†
      const usedTags = [...new Set([
        ...creative.inProgress.flatMap(p => p.tags || []),
        ...creative.completed.flatMap(p => p.tags || []),
        ...creative.onHold.flatMap(p => p.tags || []),
        ...ideas.flatMap(i => i.tags || [])
      ])];

      const addProject = (status) => {
        const newProject = { id: `project-${Date.now()}`, name: 'æ–°è¦ä½œå“', tags: [], expanded: true, targetCount: 0, collapsedSections: {}, items: [
          { id: `item-${Date.now()}-1`, type: 'chapter', name: '1è©±', content: '', sectionId: null },
          { id: `item-${Date.now()}-2`, type: 'memo', name: 'ãƒ—ãƒ­ãƒƒãƒˆ', content: '' },
        ]};
        setData({...data, creative: {...creative, [status]: [...creative[status], newProject]}});
      };

      const addItem = (projectId, status, type, sectionId = null) => {
        setData({...data, creative: {...creative, [status]: creative[status].map(p => {
          if (p.id === projectId) {
            if (type === 'section') {
              const sectionCount = p.items.filter(i => i.type === 'section').length;
              return {...p, items: [...p.items, { id: `section-${Date.now()}`, type: 'section', name: `${sectionCount + 1}ç« `, expanded: true }]};
            }
            const count = p.items.filter(i => i.type === type).length;
            const newItem = { id: `item-${Date.now()}`, type, name: type === 'chapter' ? `${count + 1}è©±` : `ãƒ¡ãƒ¢${count > 0 ? count + 1 : ''}`, content: '' };
            if (type === 'chapter') newItem.sectionId = sectionId;
            return {...p, items: [...p.items, newItem]};
          }
          return p;
        })}});
      };

      // ç« ã®æŠ˜ã‚ŠãŸãŸã¿åˆ‡ã‚Šæ›¿ãˆ
      const toggleChapterSection = (projectId, sectionId, status) => {
        setData({...data, creative: {...creative, [status]: creative[status].map(p => {
          if (p.id === projectId) {
            return {...p, items: p.items.map(i => i.id === sectionId ? {...i, expanded: !i.expanded} : i)};
          }
          return p;
        })}});
      };

      // è©±ã‚’ç« ã«ç§»å‹•
      const moveItemToSection = (projectId, itemId, newSectionId, status) => {
        setData({...data, creative: {...creative, [status]: creative[status].map(p => {
          if (p.id === projectId) {
            return {...p, items: p.items.map(i => i.id === itemId ? {...i, sectionId: newSectionId} : i)};
          }
          return p;
        })}});
      };

      // ã‚¢ã‚¤ãƒ†ãƒ ã®ä¸¦ã¹æ›¿ãˆ
      const reorderItems = (projectId, status, draggedId, targetId, position) => {
        setData({...data, creative: {...creative, [status]: creative[status].map(p => {
          if (p.id === projectId) {
            const items = [...p.items];
            const draggedIdx = items.findIndex(i => i.id === draggedId);
            const targetIdx = items.findIndex(i => i.id === targetId);
            if (draggedIdx === -1 || targetIdx === -1) return p;
            const [dragged] = items.splice(draggedIdx, 1);
            const insertIdx = position === 'before' ? targetIdx : targetIdx + 1;
            items.splice(draggedIdx < targetIdx ? insertIdx - 1 : insertIdx, 0, dragged);
            
            // è©±æ•°ã®è‡ªå‹•æŒ¯ã‚Šç›´ã—ï¼ˆã€Œâ—‹è©±ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿å¯¾è±¡ï¼‰
            const renumberPattern = /^(\d+)è©±$/;
            let chapterNum = 1;
            const renumberedItems = items.map(item => {
              if (item.type === 'chapter' && renumberPattern.test(item.name)) {
                return { ...item, name: `${chapterNum++}è©±` };
              }
              return item;
            });
            
            return {...p, items: renumberedItems};
          }
          return p;
        })}});
      };

      const toggleProject = (projectId, status) => {
        setData({...data, creative: {...creative, [status]: creative[status].map(p => p.id === projectId ? {...p, expanded: !p.expanded} : p)}});
      };

      const renameItem = (projectId, itemId, status, newName) => {
        setData({...data, creative: {...creative, [status]: creative[status].map(p => p.id === projectId ? {...p, items: p.items.map(i => i.id === itemId ? {...i, name: newName} : i)} : p)}});
        if (selectedItem?.id === itemId) setSelectedItem({...selectedItem, name: newName});
      };

      const deleteItem = (projectId, itemId, status) => {
        if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          setData({...data, creative: {...creative, [status]: creative[status].map(p => {
            if (p.id === projectId) {
              const deletedItem = p.items.find(i => i.id === itemId);
              let newItems = p.items.filter(i => i.id !== itemId);
              // ç« ã‚’å‰Šé™¤ã—ãŸå ´åˆã€ãã®ç« ã«å±ã—ã¦ã„ãŸè©±ã®sectionIdã‚’nullã«ã™ã‚‹
              if (deletedItem && deletedItem.type === 'section') {
                newItems = newItems.map(i => i.sectionId === itemId ? {...i, sectionId: null} : i);
              }
              return {...p, items: newItems};
            }
            return p;
          })}});
          if (selectedItem?.id === itemId) setSelectedItem(null);
        }
      };

      const renameProject = (projectId, status, newName) => {
        setData({...data, creative: {...creative, [status]: creative[status].map(p => p.id === projectId ? {...p, name: newName} : p)}});
      };

      // ã‚¿ã‚°é–¢é€£
      const addTagToProject = (projectId, status, tag) => {
        setData({...data, creative: {...creative, [status]: creative[status].map(p => 
          p.id === projectId && !p.tags.includes(tag) ? {...p, tags: [...p.tags, tag]} : p
        )}});
      };

      const removeTagFromProject = (projectId, status, tag) => {
        setData({...data, creative: {...creative, [status]: creative[status].map(p => 
          p.id === projectId ? {...p, tags: p.tags.filter(t => t !== tag)} : p
        )}});
      };

      // ç›®æ¨™æ–‡å­—æ•°æ›´æ–°
      const updateProjectTarget = (projectId, status, targetCount) => {
        setData({...data, creative: {...creative, [status]: creative[status].map(p => 
          p.id === projectId ? {...p, targetCount} : p
        )}});
      };

      // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
      const handleProjectDragStart = (e, project, fromStatus) => {
        setDraggedProject({ project, fromStatus });
        e.dataTransfer.effectAllowed = 'move';
      };

      const handleStatusDragOver = (e, status) => {
        e.preventDefault();
        setDragOverStatus(status);
      };

      const handleStatusDrop = (e, toStatus) => {
        e.preventDefault();
        if (draggedProject && draggedProject.fromStatus !== toStatus) {
          const { project, fromStatus } = draggedProject;
          setData({
            ...data,
            creative: {
              ...creative,
              [fromStatus]: creative[fromStatus].filter(p => p.id !== project.id),
              [toStatus]: [...creative[toStatus], project]
            }
          });
        }
        setDraggedProject(null);
        setDragOverStatus(null);
      };

      const handleDragEnd = () => {
        setDraggedProject(null);
        setDragOverStatus(null);
      };

      // ã‚»ã‚¯ã‚·ãƒ§ãƒ³æŠ˜ã‚ŠãŸãŸã¿
      const toggleSection = (section) => {
        const newCollapsed = { ...collapsedSections, [section]: !collapsedSections[section] };
        setCollapsedSections(newCollapsed);
        setData({ ...data, collapsedSections: newCollapsed });
      };

      // ãƒã‚¿é–¢é€£
      const addIdea = () => {
        const newIdea = { id: `idea-${Date.now()}`, title: 'æ–°ã—ã„ãƒã‚¿', content: '', tags: [], status: 'unused', createdAt: new Date().toISOString() };
        setData({ ...data, creative: { ...creative, ideas: [newIdea, ...ideas] } });
        setSelectedItem({ ...newIdea, isIdea: true });
      };

      const updateIdea = (id, field, value) => {
        const newIdeas = ideas.map(i => i.id === id ? { ...i, [field]: value } : i);
        setData({ ...data, creative: { ...creative, ideas: newIdeas } });
        if (selectedItem?.id === id) setSelectedItem({ ...selectedItem, [field]: value });
      };

      const deleteIdea = (id) => {
        if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          setData({ ...data, creative: { ...creative, ideas: ideas.filter(i => i.id !== id) } });
          if (selectedItem?.id === id) setSelectedItem(null);
        }
      };

      // ãƒã‚¿ã‚’ãƒ—ãƒ­ãƒƒãƒˆã«å¤‰æ›
      const convertIdeaToProject = (idea) => {
        const newProject = {
          id: `project-${Date.now()}`,
          name: idea.title,
          tags: idea.tags || [],
          expanded: true,
          targetCount: 0,
          items: [
            { id: `item-${Date.now()}-1`, type: 'chapter', name: '1è©±', content: '' },
            { id: `item-${Date.now()}-2`, type: 'memo', name: 'ãƒ—ãƒ­ãƒƒãƒˆ', content: idea.content || '' },
          ]
        };
        // ãƒã‚¿ã‚’ä½¿ç”¨æ¸ˆã¿ã«å¤‰æ›´ã—ã€ä½œå“ã‚’è¿½åŠ 
        const newIdeas = ideas.map(i => i.id === idea.id ? { ...i, status: 'used' } : i);
        setData({
          ...data,
          creative: {
            ...creative,
            inProgress: [...creative.inProgress, newProject],
            ideas: newIdeas
          }
        });
        setActiveTab('works');
      };

      // ä½œå“å‰Šé™¤
      const deleteProject = (projectId, status) => {
        if (confirm('ä½œå“å…¨ä½“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆè©±ãƒ»ãƒ¡ãƒ¢ã‚‚ã™ã¹ã¦æ¶ˆãˆã¾ã™ï¼‰')) {
          setData({...data, creative: {...creative, [status]: creative[status].filter(p => p.id !== projectId)}});
        }
      };

      // ä½œå“ã‚’TXTã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      const downloadProjectAsTxt = (project) => {
        let txtContent = '';
        txtContent += 'â•'.repeat(50) + '\n';
        txtContent += `ã€${project.name}ã€‘\n`;
        txtContent += 'â•'.repeat(50) + '\n\n';
        const chapters = project.items.filter(i => i.type === 'chapter');
        chapters.forEach(chapter => {
          txtContent += `â”€â”€ ${chapter.name} â”€â”€\n\n`;
          txtContent += (chapter.content || '') + '\n\n';
        });
        const blob = new Blob([txtContent], { type: 'text/plain; charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${project.name}.txt`;
        a.click();
        URL.revokeObjectURL(url);
      };

      // è©±ã‚’ä¿ç•™ã«ç§»å‹•
      const moveItemToHold = (projectId, item, status) => {
        const project = creative[status].find(p => p.id === projectId);
        const holdItem = {
          ...item,
          id: `hold-${Date.now()}`,
          originalProjectId: projectId,
          originalProjectName: project?.name || 'ä¸æ˜',
          originalStatus: status,
          movedAt: new Date().toISOString()
        };
        const holdItems = creative.holdItems || [];
        setData({
          ...data,
          creative: {
            ...creative,
            [status]: creative[status].map(p => p.id === projectId ? {...p, items: p.items.filter(i => i.id !== item.id)} : p),
            holdItems: [...holdItems, holdItem]
          }
        });
      };

      // ä¿ç•™ã‹ã‚‰è©±ã‚’æˆ»ã™
      const moveItemFromHold = (holdItem) => {
        const { originalProjectId, originalStatus } = holdItem;
        const holdItems = creative.holdItems || [];
        
        // å…ƒã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã¾ã å­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
        const originalProject = creative[originalStatus]?.find(p => p.id === originalProjectId);
        
        if (originalProject) {
          // å…ƒã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æˆ»ã™
          const restoredItem = { id: holdItem.id, type: holdItem.type, name: holdItem.name, content: holdItem.content };
          setData({
            ...data,
            creative: {
              ...creative,
              [originalStatus]: creative[originalStatus].map(p => 
                p.id === originalProjectId ? {...p, items: [...p.items, restoredItem]} : p
              ),
              holdItems: holdItems.filter(i => i.id !== holdItem.id)
            }
          });
        } else {
          alert('å…ƒã®ä½œå“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚\næ–°ã—ã„ä½œå“ã¨ã—ã¦è¿½åŠ ã—ã¦ãã ã•ã„ã€‚');
        }
      };

      // ä¿ç•™ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
      const deleteHoldItem = (itemId) => {
        if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          const holdItems = creative.holdItems || [];
          setData({...data, creative: {...creative, holdItems: holdItems.filter(i => i.id !== itemId)}});
        }
      };

      // ä¿ç•™ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´
      const renameHoldItem = (itemId, newName) => {
        const holdItems = creative.holdItems || [];
        setData({...data, creative: {...creative, holdItems: holdItems.map(i => i.id === itemId ? {...i, name: newName} : i)}});
      };

      // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
      const filterByTag = (projects) => {
        if (tagFilter === 'all') return projects;
        return projects.filter(p => (p.tags || []).includes(tagFilter));
      };

      const filteredIdeas = tagFilter === 'all' ? ideas : ideas.filter(i => (i.tags || []).includes(tagFilter));

      const renderList = (projects, status, title, icon, collapsible = false) => {
        const filteredProjects = filterByTag(projects);
        const isCollapsed = collapsible && collapsedSections[status];
        
        return (
          <div 
            style={{ marginBottom: '16px' }}
            onDragOver={(e) => handleStatusDragOver(e, status)}
            onDrop={(e) => handleStatusDrop(e, status)}
          >
            <div 
              onClick={() => collapsible && toggleSection(status)}
              style={{ 
                display: 'flex', alignItems: 'center', justifyContent: 'space-between', 
                padding: '8px 12px', color: theme.textSecondary, fontSize: '11px', 
                textTransform: 'uppercase', letterSpacing: '0.5px', 
                background: dragOverStatus === status ? theme.highlight : 'transparent', 
                borderRadius: '6px', transition: 'background 0.2s',
                cursor: collapsible ? 'pointer' : 'default'
              }}
            >
              <span style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                {collapsible && (
                  <span style={{ transform: isCollapsed ? 'rotate(0deg)' : 'rotate(90deg)', transition: 'transform 0.2s', display: 'flex' }}>
                    <Icons.ChevronRight />
                  </span>
                )}
                {icon} {title} ({filteredProjects.length})
              </span>
              <button onClick={(e) => { e.stopPropagation(); addProject(status); }} style={{ background: 'none', border: 'none', color: theme.textSecondary, cursor: 'pointer', padding: '2px' }}><Icons.Plus /></button>
            </div>
            
            {!isCollapsed && filteredProjects.map(p => (
              <div 
                key={p.id}
                draggable
                onDragStart={(e) => handleProjectDragStart(e, p, status)}
                onDragEnd={handleDragEnd}
              >
                <div style={{ display: 'flex', alignItems: 'center', padding: '8px 12px', margin: '0 8px', borderRadius: '6px', gap: '6px', background: p.expanded ? theme.bgTertiary : 'transparent', cursor: 'grab' }}>
                  <Icons.GripVertical />
                  <span onClick={() => toggleProject(p.id, status)} style={{ cursor: 'pointer', display: 'flex' }}>{p.expanded ? <Icons.ChevronDown /> : <Icons.ChevronRight />}</span>
                  <Icons.Folder />
                  {editingProjectId === p.id ? (
                    <input type="text" value={p.name} onChange={(e) => renameProject(p.id, status, e.target.value)} onBlur={() => setEditingProjectId(null)} onKeyDown={(e) => e.key === 'Enter' && setEditingProjectId(null)} autoFocus style={{ flex: 1, fontSize: '13px', fontWeight: '500', background: theme.bg, border: `1px solid ${theme.accent}`, outline: 'none', color: theme.text, padding: '2px 6px', borderRadius: '4px' }} />
                  ) : (
                    <span onDoubleClick={() => setEditingProjectId(p.id)} style={{ flex: 1, fontSize: '13px', fontWeight: '500', cursor: 'default' }}>{p.name}</span>
                  )}
                  <span style={{ fontSize: '11px', color: theme.accent }}>{countChars(p).toLocaleString()}å­—</span>
                  <button onClick={(e) => { e.stopPropagation(); downloadProjectAsTxt(p); }} style={{ background: 'none', border: 'none', color: theme.success, cursor: 'pointer', padding: '2px', opacity: 0.6 }} title="TXTãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"><Icons.Download /></button>
                  <button onClick={(e) => { e.stopPropagation(); deleteProject(p.id, status); }} style={{ background: 'none', border: 'none', color: theme.error, cursor: 'pointer', padding: '2px', opacity: 0.5 }} title="ä½œå“ã‚’å‰Šé™¤"><Icons.Trash /></button>
                </div>
                
                {/* ã‚¿ã‚° & ç›®æ¨™æ–‡å­—æ•° */}
                {p.expanded && (
                  <div style={{ padding: '4px 12px 6px 48px' }} onClick={(e) => e.stopPropagation()}>
                    {/* 1è¡Œç›®: ã‚¿ã‚°è¿½åŠ ãƒœã‚¿ãƒ³ & ç›®æ¨™æ–‡å­—æ•° */}
                    <div style={{ display: 'flex', alignItems: 'center', gap: '6px', flexWrap: 'wrap' }}>
                      <div style={{ position: 'relative' }}>
                        <button onClick={(e) => { e.stopPropagation(); setShowTagSelector(showTagSelector === p.id ? null : p.id); }} style={{ fontSize: '9px', padding: '2px 5px', background: theme.bgTertiary, color: theme.textSecondary, border: `1px dashed ${theme.border}`, borderRadius: '3px', cursor: 'pointer' }}>+ã‚¿ã‚°</button>
                        {showTagSelector === p.id && (
                          <div onClick={(e) => e.stopPropagation()} style={{ position: 'absolute', top: '100%', left: 0, background: theme.bgSecondary, border: `1px solid ${theme.border}`, borderRadius: '6px', padding: '8px', zIndex: 100, minWidth: '120px', boxShadow: '0 4px 12px rgba(0,0,0,0.2)' }}>
                            {(data.tags || []).filter(t => !(p.tags || []).includes(t)).map(tag => (
                              <div key={tag} onClick={(e) => { e.stopPropagation(); addTagToProject(p.id, status, tag); setShowTagSelector(null); }} style={{ padding: '4px 8px', fontSize: '11px', cursor: 'pointer', borderRadius: '4px', color: theme.text }} onMouseOver={(e) => e.target.style.background = theme.bgTertiary} onMouseOut={(e) => e.target.style.background = 'transparent'}>{tag}</div>
                            ))}
                            {(data.tags || []).filter(t => !(p.tags || []).includes(t)).length === 0 && (
                              <div style={{ padding: '4px 8px', fontSize: '11px', color: theme.textSecondary }}>{(data.tags || []).length === 0 ? 'âš™ï¸è¨­å®šã§ã‚¿ã‚°è¿½åŠ ' : 'å…¨ã‚¿ã‚°ä»˜ä¸æ¸ˆ'}</div>
                            )}
                          </div>
                        )}
                      </div>
                      
                      {/* åŒºåˆ‡ã‚Š */}
                      <span style={{ color: theme.border, margin: '0 2px' }}>|</span>
                      
                      {/* ç›®æ¨™æ–‡å­—æ•° */}
                      <span style={{ fontSize: '9px', color: theme.textSecondary }}>ç›®æ¨™:</span>
                      <input 
                        type="number" 
                        value={p.targetCount || ''} 
                        onChange={(e) => updateProjectTarget(p.id, status, parseInt(e.target.value) || 0)}
                        placeholder="0"
                        style={{ width: '50px', padding: '1px 3px', fontSize: '9px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '3px', color: theme.text, textAlign: 'right' }}
                      />
                      <span style={{ fontSize: '9px', color: theme.textSecondary }}>å­—</span>
                      {p.targetCount > 0 && (
                        <>
                          <div style={{ flex: 1, minWidth: '40px', maxWidth: '80px', height: '5px', background: theme.bgTertiary, borderRadius: '3px', overflow: 'hidden' }}>
                            <div style={{ width: `${Math.min(100, (countChars(p) / p.targetCount) * 100)}%`, height: '100%', background: countChars(p) >= p.targetCount ? theme.success : theme.accent, transition: 'width 0.3s' }} />
                          </div>
                          <span style={{ fontSize: '9px', color: countChars(p) >= p.targetCount ? theme.success : theme.textSecondary, fontWeight: '500' }}>
                            {Math.round((countChars(p) / p.targetCount) * 100)}%
                          </span>
                        </>
                      )}
                    </div>
                    
                    {/* 2è¡Œç›®: è¿½åŠ ã•ã‚ŒãŸã‚¿ã‚° */}
                    {(p.tags || []).length > 0 && (
                      <div style={{ display: 'flex', gap: '4px', flexWrap: 'wrap', marginTop: '4px' }}>
                        {(p.tags || []).map(tag => (
                          <span key={tag} style={{ fontSize: '9px', padding: '2px 5px', background: theme.accent, color: '#fff', borderRadius: '3px', display: 'flex', alignItems: 'center', gap: '2px' }}>
                            {tag}
                            <button onClick={(e) => { e.stopPropagation(); removeTagFromProject(p.id, status, tag); }} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', padding: 0, display: 'flex', fontSize: '9px' }}>Ã—</button>
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                )}

                {p.expanded && (
                  <div style={{ marginLeft: '16px' }}>
                    {/* ç« ã«å±ã•ãªã„è©±ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ï¼‰ */}
                    {p.items.some(i => i.type === 'section') && (
                      <div 
                        onDragOver={(e) => { e.preventDefault(); e.currentTarget.style.background = theme.highlight; }}
                        onDragLeave={(e) => { e.currentTarget.style.background = 'transparent'; }}
                        onDrop={(e) => { e.preventDefault(); e.currentTarget.style.background = 'transparent'; const draggedId = e.dataTransfer.getData('itemId'); const draggedItem = p.items.find(i => i.id === draggedId); if (draggedItem && draggedItem.type === 'chapter') moveItemToSection(p.id, draggedId, null, status); }}
                        style={{ padding: '4px 10px', margin: '0 6px 2px', fontSize: '10px', color: theme.textSecondary, borderRadius: '4px', border: `1px dashed ${theme.border}` }}
                      >
                        ğŸ“„ ç« ãªã—ï¼ˆã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—ã§ç« ã‹ã‚‰å¤–ã™ï¼‰
                      </div>
                    )}
                    {/* ç« ã«å±ã•ãªã„è©± */}
                    {p.items.filter(i => i.type === 'chapter' && !i.sectionId).map((item, idx) => (
                      <div 
                        key={item.id} 
                        draggable
                        onDragStart={(e) => { e.stopPropagation(); e.dataTransfer.setData('itemId', item.id); e.dataTransfer.setData('projectId', p.id); e.dataTransfer.setData('status', status); }}
                        onDragOver={(e) => { e.preventDefault(); e.stopPropagation(); e.currentTarget.style.borderTop = `2px solid ${theme.accent}`; }}
                        onDragLeave={(e) => { e.currentTarget.style.borderTop = 'none'; }}
                        onDrop={(e) => { e.preventDefault(); e.stopPropagation(); e.currentTarget.style.borderTop = 'none'; const draggedId = e.dataTransfer.getData('itemId'); if (draggedId && draggedId !== item.id) reorderItems(p.id, status, draggedId, item.id, 'before'); }}
                        onClick={() => setSelectedItem({...item, projectId: p.id, status})} 
                        style={{ display: 'flex', alignItems: 'center', padding: '5px 10px', margin: '1px 6px', borderRadius: '4px', cursor: 'grab', gap: '6px', fontSize: '12px', background: selectedItem?.id === item.id ? theme.highlight : 'transparent' }}
                      >
                        <Icons.GripVertical />
                        <Icons.FileText />
                        {editingItemId === item.id ? (
                          <input type="text" value={item.name} onChange={(e) => renameItem(p.id, item.id, status, e.target.value)} onBlur={() => setEditingItemId(null)} onKeyDown={(e) => e.key === 'Enter' && setEditingItemId(null)} onClick={(e) => e.stopPropagation()} autoFocus style={{ flex: 1, background: theme.bg, border: `1px solid ${theme.accent}`, outline: 'none', color: theme.text, fontSize: '12px', padding: '2px 6px', borderRadius: '4px' }} />
                        ) : (
                          <span onDoubleClick={(e) => { e.stopPropagation(); setEditingItemId(item.id); }} style={{ flex: 1 }}>{item.name}</span>
                        )}
                        <span style={{ fontSize: '10px', color: theme.accent, fontWeight: '500' }}>{(item.content || '').replace(/[\s\n]/g, '').length.toLocaleString()}å­—</span>
                        <button onClick={(e) => { e.stopPropagation(); openInNewPane({...item, projectId: p.id, status}); }} style={{ background: 'none', border: 'none', color: theme.success, cursor: 'pointer', padding: '2px', opacity: 0.6 }} title="æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã"><Icons.Plus /></button>
                        <button onClick={(e) => { e.stopPropagation(); moveItemToHold(p.id, item, status); }} style={{ background: 'none', border: 'none', color: theme.warning, cursor: 'pointer', padding: '2px', opacity: 0.6 }} title="ä¿ç•™ã«ç§»å‹•"><Icons.Pause /></button>
                        <button onClick={(e) => { e.stopPropagation(); deleteItem(p.id, item.id, status); }} style={{ background: 'none', border: 'none', color: theme.textSecondary, cursor: 'pointer', padding: '2px', opacity: 0.5 }}><Icons.Trash /></button>
                      </div>
                    ))}
                    
                    {/* ç« ã¨ãã®ä¸­ã®è©± */}
                    {p.items.filter(i => i.type === 'section').map(section => {
                      const sectionChapters = p.items.filter(i => i.type === 'chapter' && i.sectionId === section.id);
                      const sectionCharCount = sectionChapters.reduce((sum, i) => sum + (i.content || '').replace(/[\s\n]/g, '').length, 0);
                      return (
                        <div key={section.id} style={{ marginTop: '6px' }}>
                          {/* ç« ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                          <div 
                            draggable
                            onDragStart={(e) => { e.stopPropagation(); e.dataTransfer.setData('itemId', section.id); e.dataTransfer.setData('projectId', p.id); e.dataTransfer.setData('status', status); }}
                            onDragOver={(e) => { e.preventDefault(); e.stopPropagation(); }}
                            onDrop={(e) => { e.preventDefault(); e.stopPropagation(); const draggedId = e.dataTransfer.getData('itemId'); const draggedItem = p.items.find(i => i.id === draggedId); if (draggedItem && draggedItem.type === 'chapter') moveItemToSection(p.id, draggedId, section.id, status); }}
                            style={{ display: 'flex', alignItems: 'center', padding: '4px 8px', margin: '0 6px', borderRadius: '4px', gap: '4px', fontSize: '11px', background: theme.bgTertiary, cursor: 'grab', borderLeft: `3px solid ${theme.accent}` }}
                          >
                            <Icons.GripVertical />
                            <span onClick={(e) => { e.stopPropagation(); toggleChapterSection(p.id, section.id, status); }} style={{ cursor: 'pointer', display: 'flex', transform: section.expanded ? 'rotate(90deg)' : 'rotate(0deg)', transition: 'transform 0.2s' }}><Icons.ChevronRight /></span>
                            {editingItemId === section.id ? (
                              <input type="text" value={section.name} onChange={(e) => renameItem(p.id, section.id, status, e.target.value)} onBlur={() => setEditingItemId(null)} onKeyDown={(e) => e.key === 'Enter' && setEditingItemId(null)} onClick={(e) => e.stopPropagation()} autoFocus style={{ flex: 1, background: theme.bg, border: `1px solid ${theme.accent}`, outline: 'none', color: theme.accent, fontSize: '11px', padding: '2px 6px', borderRadius: '4px', fontWeight: '600' }} />
                            ) : (
                              <span onDoubleClick={(e) => { e.stopPropagation(); setEditingItemId(section.id); }} style={{ flex: 1, fontWeight: '600', color: theme.accent }}>{section.name}</span>
                            )}
                            <span style={{ fontSize: '9px', color: theme.textSecondary }}>{sectionChapters.length}è©±</span>
                            <span style={{ fontSize: '9px', color: theme.accent }}>{sectionCharCount.toLocaleString()}å­—</span>
                            <button onClick={(e) => { e.stopPropagation(); deleteItem(p.id, section.id, status); }} style={{ background: 'none', border: 'none', color: theme.textSecondary, cursor: 'pointer', padding: '2px', opacity: 0.5 }} title="ç« ã‚’å‰Šé™¤"><Icons.Trash /></button>
                          </div>
                          {/* ç« å†…ã®è©± */}
                          {section.expanded !== false && (
                            <div 
                              style={{ marginLeft: '12px', borderLeft: `1px dashed ${theme.border}`, marginTop: '2px' }}
                              onDragOver={(e) => { e.preventDefault(); }}
                              onDrop={(e) => { e.preventDefault(); const draggedId = e.dataTransfer.getData('itemId'); const draggedItem = p.items.find(i => i.id === draggedId); if (draggedItem && draggedItem.type === 'chapter') moveItemToSection(p.id, draggedId, section.id, status); }}
                            >
                              {sectionChapters.map(item => (
                                <div 
                                  key={item.id} 
                                  draggable
                                  onDragStart={(e) => { e.stopPropagation(); e.dataTransfer.setData('itemId', item.id); e.dataTransfer.setData('projectId', p.id); e.dataTransfer.setData('status', status); }}
                                  onDragOver={(e) => { e.preventDefault(); e.stopPropagation(); e.currentTarget.style.borderTop = `2px solid ${theme.accent}`; }}
                                  onDragLeave={(e) => { e.currentTarget.style.borderTop = 'none'; }}
                                  onDrop={(e) => { e.preventDefault(); e.stopPropagation(); e.currentTarget.style.borderTop = 'none'; const draggedId = e.dataTransfer.getData('itemId'); if (draggedId && draggedId !== item.id) reorderItems(p.id, status, draggedId, item.id, 'before'); }}
                                  onClick={() => setSelectedItem({...item, projectId: p.id, status})} 
                                  style={{ display: 'flex', alignItems: 'center', padding: '5px 10px', margin: '1px 6px', borderRadius: '4px', cursor: 'grab', gap: '6px', fontSize: '12px', background: selectedItem?.id === item.id ? theme.highlight : 'transparent' }}
                                >
                                  <Icons.GripVertical />
                                  <Icons.FileText />
                                  {editingItemId === item.id ? (
                                    <input type="text" value={item.name} onChange={(e) => renameItem(p.id, item.id, status, e.target.value)} onBlur={() => setEditingItemId(null)} onKeyDown={(e) => e.key === 'Enter' && setEditingItemId(null)} onClick={(e) => e.stopPropagation()} autoFocus style={{ flex: 1, background: theme.bg, border: `1px solid ${theme.accent}`, outline: 'none', color: theme.text, fontSize: '12px', padding: '2px 6px', borderRadius: '4px' }} />
                                  ) : (
                                    <span onDoubleClick={(e) => { e.stopPropagation(); setEditingItemId(item.id); }} style={{ flex: 1 }}>{item.name}</span>
                                  )}
                                  <span style={{ fontSize: '10px', color: theme.accent, fontWeight: '500' }}>{(item.content || '').replace(/[\s\n]/g, '').length.toLocaleString()}å­—</span>
                                  <button onClick={(e) => { e.stopPropagation(); openInNewPane({...item, projectId: p.id, status}); }} style={{ background: 'none', border: 'none', color: theme.success, cursor: 'pointer', padding: '2px', opacity: 0.6 }} title="æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã"><Icons.Plus /></button>
                                  <button onClick={(e) => { e.stopPropagation(); moveItemToHold(p.id, item, status); }} style={{ background: 'none', border: 'none', color: theme.warning, cursor: 'pointer', padding: '2px', opacity: 0.6 }} title="ä¿ç•™ã«ç§»å‹•"><Icons.Pause /></button>
                                  <button onClick={(e) => { e.stopPropagation(); deleteItem(p.id, item.id, status); }} style={{ background: 'none', border: 'none', color: theme.textSecondary, cursor: 'pointer', padding: '2px', opacity: 0.5 }}><Icons.Trash /></button>
                                </div>
                              ))}
                              {sectionChapters.length === 0 && (
                                <div style={{ padding: '8px 16px', fontSize: '10px', color: theme.textSecondary, opacity: 0.7 }}>è©±ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã“ã“ã«è¿½åŠ </div>
                              )}
                              <button onClick={() => addItem(p.id, status, 'chapter', section.id)} style={{ margin: '4px 6px', padding: '3px 8px', fontSize: '10px', background: 'transparent', border: `1px dashed ${theme.border}`, borderRadius: '4px', color: theme.textSecondary, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '4px' }}><Icons.Plus /> ã“ã®ç« ã«è©±ã‚’è¿½åŠ </button>
                            </div>
                          )}
                        </div>
                      );
                    })}
                    
                    {/* ãƒ¡ãƒ¢ */}
                    {p.items.filter(i => i.type === 'memo').length > 0 && (
                      <div style={{ marginTop: '4px', paddingTop: '4px', borderTop: `1px dashed ${theme.border}`, marginRight: '6px' }}>
                        <div style={{ fontSize: '9px', color: theme.textSecondary, marginBottom: '2px', marginLeft: '10px' }}>ğŸ“ ãƒ¡ãƒ¢ãƒ»è³‡æ–™</div>
                        {p.items.filter(i => i.type === 'memo').map(item => (
                          <div key={item.id} onClick={() => setSelectedItem({...item, projectId: p.id, status})} style={{ display: 'flex', alignItems: 'center', padding: '5px 10px', margin: '1px 6px', borderRadius: '4px', cursor: 'pointer', gap: '6px', fontSize: '12px', background: selectedItem?.id === item.id ? theme.highlight : 'transparent', opacity: 0.85 }}>
                              <Icons.File />
                              {editingItemId === item.id ? (
                                <input type="text" value={item.name} onChange={(e) => renameItem(p.id, item.id, status, e.target.value)} onBlur={() => setEditingItemId(null)} onKeyDown={(e) => e.key === 'Enter' && setEditingItemId(null)} onClick={(e) => e.stopPropagation()} autoFocus style={{ flex: 1, background: theme.bg, border: `1px solid ${theme.accent}`, outline: 'none', color: theme.textSecondary, fontSize: '12px', padding: '2px 6px', borderRadius: '4px' }} />
                              ) : (
                                <span onDoubleClick={(e) => { e.stopPropagation(); setEditingItemId(item.id); }} style={{ flex: 1, color: theme.textSecondary }}>{item.name}</span>
                              )}
                              <button onClick={(e) => { e.stopPropagation(); openInNewPane({...item, projectId: p.id, status}); }} style={{ background: 'none', border: 'none', color: theme.success, cursor: 'pointer', padding: '2px', opacity: 0.6 }} title="æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã"><Icons.Plus /></button>
                              <button onClick={(e) => { e.stopPropagation(); deleteItem(p.id, item.id, status); }} style={{ background: 'none', border: 'none', color: theme.textSecondary, cursor: 'pointer', padding: '2px', opacity: 0.5 }}><Icons.Trash /></button>
                          </div>
                        ))}
                      </div>
                    )}
                    
                    {/* è¿½åŠ ãƒœã‚¿ãƒ³ */}
                    <div style={{ display: 'flex', gap: '4px', padding: '6px 10px', flexWrap: 'wrap' }}>
                      <button onClick={() => addItem(p.id, status, 'chapter')} style={{ padding: '4px 8px', fontSize: '10px', background: theme.accent, border: 'none', borderRadius: '4px', color: '#fff', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '4px' }}><Icons.Plus /> è©±</button>
                      <button onClick={() => addItem(p.id, status, 'section')} style={{ padding: '4px 8px', fontSize: '10px', background: theme.accentLight, border: 'none', borderRadius: '4px', color: '#fff', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '4px' }}><Icons.Plus /> ç« </button>
                      <button onClick={() => addItem(p.id, status, 'memo')} style={{ padding: '4px 8px', fontSize: '10px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '4px', color: theme.textSecondary, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '4px' }}><Icons.Plus /> ãƒ¡ãƒ¢</button>
                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>
        );
      };

      // ä¿ç•™ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè©±å˜ä½ï¼‰ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      const renderHoldItems = () => {
        const holdItems = creative.holdItems || [];
        const isCollapsed = collapsedSections.holdItems;

        return (
          <div style={{ marginBottom: '16px' }}>
            <div 
              onClick={() => toggleSection('holdItems')}
              style={{ 
                display: 'flex', alignItems: 'center', justifyContent: 'space-between', 
                padding: '8px 12px', color: theme.textSecondary, fontSize: '11px', 
                textTransform: 'uppercase', letterSpacing: '0.5px', 
                borderRadius: '6px', cursor: 'pointer'
              }}
            >
              <span style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                <span style={{ transform: isCollapsed ? 'rotate(0deg)' : 'rotate(90deg)', transition: 'transform 0.2s', display: 'flex' }}>
                  <Icons.ChevronRight />
                </span>
                â¸ï¸ ä¿ç•™ï¼ˆè©±å˜ä½ï¼‰({holdItems.length})
              </span>
            </div>
            
            {!isCollapsed && holdItems.map(item => (
              <div key={item.id} onClick={() => setSelectedItem({ ...item, isHoldItem: true })} style={{ display: 'flex', alignItems: 'center', padding: '8px 12px', margin: '2px 8px', borderRadius: '6px', cursor: 'pointer', gap: '8px', fontSize: '13px', background: selectedItem?.id === item.id ? theme.highlight : theme.bgTertiary }}>
                <Icons.Pause />
                <div style={{ flex: 1, minWidth: 0 }}>
                  <div style={{ fontWeight: '500', marginBottom: '2px' }}>{item.name}</div>
                  <div style={{ fontSize: '10px', color: theme.textSecondary, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>
                    å…ƒ: {item.originalProjectName}
                  </div>
                </div>
                <span style={{ fontSize: '11px', color: theme.accent, fontWeight: '500' }}>{(item.content || '').replace(/[\s\n]/g, '').length.toLocaleString()}å­—</span>
                <button onClick={(e) => { e.stopPropagation(); moveItemFromHold(item); }} style={{ padding: '2px 6px', fontSize: '9px', background: theme.success, color: '#fff', border: 'none', borderRadius: '4px', cursor: 'pointer' }} title="å…ƒã«æˆ»ã™">æˆ»ã™</button>
                <button onClick={(e) => { e.stopPropagation(); deleteHoldItem(item.id); }} style={{ background: 'none', border: 'none', color: theme.textSecondary, cursor: 'pointer', padding: '2px', opacity: 0.5 }}><Icons.Trash /></button>
              </div>
            ))}
            
            {!isCollapsed && holdItems.length === 0 && (
              <div style={{ padding: '12px 20px', color: theme.textSecondary, fontSize: '11px', opacity: 0.7 }}>
                è©±ã®æ¨ªã® â¸ï¸ ãƒœã‚¿ãƒ³ã§ä¿ç•™ã«ç§»å‹•ã§ãã¾ã™
              </div>
            )}
          </div>
        );
      };

      const statusLabels = { unused: 'æœªä½¿ç”¨', tweeted: 'ãƒ„ã‚¤ãƒãƒ™', posted: 'æŠ•ç¨¿æ¸ˆ', used: 'ä½¿ç”¨æ¸ˆ' };
      const statusColors = { unused: theme.accent, tweeted: theme.warning, posted: '#9b59b6', used: theme.success };

      return (
        <div style={{ height: '100%', display: 'flex', flexDirection: 'column' }} onClick={() => setShowTagSelector(null)}>
          {/* ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ */}
          <div style={{ display: 'flex', borderBottom: `1px solid ${theme.border}` }}>
            <button onClick={() => setActiveTab('works')} style={{ flex: 1, padding: '6px', fontSize: '11px', fontWeight: '500', background: activeTab === 'works' ? theme.bg : 'transparent', color: activeTab === 'works' ? theme.accent : theme.textSecondary, border: 'none', borderBottom: activeTab === 'works' ? `2px solid ${theme.accent}` : '2px solid transparent', cursor: 'pointer' }}>ğŸ“ ä½œå“</button>
            <button onClick={() => setActiveTab('ideas')} style={{ flex: 1, padding: '6px', fontSize: '11px', fontWeight: '500', background: activeTab === 'ideas' ? theme.bg : 'transparent', color: activeTab === 'ideas' ? theme.accent : theme.textSecondary, border: 'none', borderBottom: activeTab === 'ideas' ? `2px solid ${theme.accent}` : '2px solid transparent', cursor: 'pointer' }}>ğŸ’¡ ãƒã‚¿ ({ideas.length})</button>
          </div>

          {/* ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */}
          <div style={{ padding: '5px 10px', borderBottom: `1px solid ${theme.border}`, display: 'flex', gap: '3px', flexWrap: 'wrap' }}>
            <button onClick={() => setTagFilter('all')} style={{ padding: '2px 6px', fontSize: '9px', background: tagFilter === 'all' ? theme.accent : theme.bgTertiary, color: tagFilter === 'all' ? '#fff' : theme.textSecondary, border: 'none', borderRadius: '3px', cursor: 'pointer' }}>All</button>
            {usedTags.map(tag => (
              <button key={tag} onClick={() => setTagFilter(tag)} style={{ padding: '2px 6px', fontSize: '9px', background: tagFilter === tag ? theme.accent : theme.bgTertiary, color: tagFilter === tag ? '#fff' : theme.textSecondary, border: 'none', borderRadius: '3px', cursor: 'pointer' }}>{tag}</button>
            ))}
          </div>

          {activeTab === 'works' ? (
            <div style={{ flex: 1, overflow: 'auto' }}>
              <div style={{ padding: '6px 10px', borderBottom: `1px solid ${theme.border}`, fontSize: '10px', color: theme.textSecondary }}>
                ç·æ–‡å­—æ•°: <span style={{ color: theme.accent, fontWeight: '600' }}>{totalChars().toLocaleString()}</span> å­—
              </div>
              {renderList(creative.inProgress, 'inProgress', 'åˆ¶ä½œä¸­', 'ğŸ“', false)}
              {renderHoldItems()}
              {renderList(creative.onHold, 'onHold', 'åˆ¶ä½œä¸­æ–­', 'ğŸš«', true)}
              {renderList(creative.completed, 'completed', 'å®Œäº†', 'âœ…', true)}
            </div>
          ) : (
            <div style={{ flex: 1, overflow: 'auto' }}>
              <div style={{ padding: '8px 10px', borderBottom: `1px solid ${theme.border}`, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <span style={{ fontSize: '10px', color: theme.textSecondary }}>ã‚¯ãƒªãƒƒã‚¯ã§ç·¨é›†</span>
                <button onClick={addIdea} style={{ padding: '4px 10px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '10px', display: 'flex', alignItems: 'center', gap: '4px' }}><Icons.Plus /> è¿½åŠ </button>
              </div>
              <div style={{ padding: '8px' }}>
                {filteredIdeas.map(idea => (
                  <div key={idea.id} onClick={() => setSelectedItem({ ...idea, isIdea: true })} style={{ padding: '10px 12px', marginBottom: '4px', borderRadius: '8px', cursor: 'pointer', background: selectedItem?.id === idea.id ? theme.highlight : theme.bgTertiary, border: `1px solid ${selectedItem?.id === idea.id ? theme.accent : 'transparent'}` }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '4px' }}>
                      <Icons.Lightbulb />
                      {editingIdeaId === idea.id ? (
                        <input type="text" value={idea.title} onChange={(e) => updateIdea(idea.id, 'title', e.target.value)} onBlur={() => setEditingIdeaId(null)} onKeyDown={(e) => e.key === 'Enter' && setEditingIdeaId(null)} autoFocus onClick={(e) => e.stopPropagation()} style={{ flex: 1, background: theme.bg, border: `1px solid ${theme.accent}`, borderRadius: '4px', padding: '2px 6px', color: theme.text, fontSize: '12px', outline: 'none' }} />
                      ) : (
                        <span onDoubleClick={(e) => { e.stopPropagation(); setEditingIdeaId(idea.id); }} style={{ flex: 1, fontSize: '12px', fontWeight: '500' }}>{idea.title}</span>
                      )}
                      <span style={{ fontSize: '9px', padding: '2px 6px', background: statusColors[idea.status], color: '#fff', borderRadius: '4px' }}>{statusLabels[idea.status]}</span>
                    </div>
                    <div style={{ display: 'flex', gap: '4px', flexWrap: 'wrap', marginBottom: '4px' }}>
                      {(idea.tags || []).map(tag => (
                        <span key={tag} style={{ fontSize: '9px', padding: '2px 5px', background: theme.accent, color: '#fff', borderRadius: '3px' }}>{tag}</span>
                      ))}
                    </div>
                    {idea.content && (
                      <div style={{ fontSize: '10px', color: theme.textSecondary, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{idea.content.substring(0, 40)}...</div>
                    )}
                    <div style={{ display: 'flex', gap: '4px', marginTop: '6px' }}>
                      {idea.status === 'unused' && (
                        <button onClick={(e) => { e.stopPropagation(); updateIdea(idea.id, 'status', 'tweeted'); }} style={{ padding: '3px 8px', fontSize: '9px', background: theme.warning, color: '#fff', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>ğŸ“± ãƒ„ã‚¤ãƒãƒ™åŒ–</button>
                      )}
                      {(idea.status === 'unused' || idea.status === 'tweeted') && (
                        <button onClick={(e) => { e.stopPropagation(); convertIdeaToProject(idea); }} style={{ padding: '3px 8px', fontSize: '9px', background: theme.success, color: '#fff', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>â†’ ä½œå“åŒ–</button>
                      )}
                      <button onClick={(e) => { e.stopPropagation(); deleteIdea(idea.id); }} style={{ padding: '3px 8px', fontSize: '9px', background: theme.error, color: '#fff', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>å‰Šé™¤</button>
                    </div>
                  </div>
                ))}
                {filteredIdeas.length === 0 && <div style={{ textAlign: 'center', color: theme.textSecondary, padding: '40px 20px', fontSize: '12px' }}>ãƒã‚¿ãŒã‚ã‚Šã¾ã›ã‚“<br/>ã€Œ+ è¿½åŠ ã€ã§ä½œæˆã—ã¦ã­</div>}
              </div>
            </div>
          )}
        </div>
      );
    };

    // ==================== åˆ†å‰²ã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆãƒšã‚¤ãƒ³ç”¨ï¼‰ ====================
    const SplitEditor = ({ pane, onUpdate, theme, data, setData }) => {
      const [showIdeaTagSelector, setShowIdeaTagSelector] = useState(false);
      const [showReplace, setShowReplace] = useState(false);
      const [searchText, setSearchText] = useState('');
      const [replaceText, setReplaceText] = useState('');
      const textareaRef = useRef(null);

      const handleReplace = () => {
        if (!searchText || !textareaRef.current) return;
        const content = textareaRef.current.value;
        const newContent = content.split(searchText).join(replaceText);
        onUpdate(newContent);
      };

      const handleReplaceAll = () => {
        if (!searchText || !textareaRef.current) return;
        const content = textareaRef.current.value;
        const newContent = content.split(searchText).join(replaceText);
        onUpdate(newContent);
        const count = (content.match(new RegExp(searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g')) || []).length;
        alert(`${count}ä»¶ã‚’ç½®æ›ã—ã¾ã—ãŸ`);
      };

      // ãƒã‚¿ç·¨é›†
      if (pane.isIdea) {
        const ideas = data.creative.ideas || [];
        const currentIdea = ideas.find(i => i.id === pane.id) || pane;
        
        const updateIdea = (field, value) => {
          const newIdeas = ideas.map(i => i.id === pane.id ? { ...i, [field]: value } : i);
          setData({ ...data, creative: { ...data.creative, ideas: newIdeas } });
        };

        return (
          <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
            <div style={{ padding: '8px 12px', borderBottom: `1px solid ${theme.border}`, display: 'flex', alignItems: 'center', gap: '8px', background: theme.bgSecondary }}>
              <select value={currentIdea.status} onChange={(e) => updateIdea('status', e.target.value)} style={{ padding: '4px 8px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '4px', color: theme.text, fontSize: '11px' }}>
                <option value="unused">æœªä½¿ç”¨</option>
                <option value="tweeted">ãƒ„ã‚¤ãƒãƒ™</option>
                <option value="posted">æŠ•ç¨¿æ¸ˆ</option>
                <option value="used">ä½¿ç”¨æ¸ˆ</option>
              </select>
            </div>
            <textarea value={currentIdea.content || ''} onChange={(e) => { updateIdea('content', e.target.value); onUpdate(e.target.value); }} placeholder="ãƒã‚¿ã®è©³ç´°..." style={{ flex: 1, padding: '16px', background: theme.bg, border: 'none', outline: 'none', resize: 'none', fontSize: '14px', lineHeight: '1.8', color: theme.text, fontFamily: '"Noto Serif JP", serif' }} />
          </div>
        );
      }

      // ä¿ç•™ã‚¢ã‚¤ãƒ†ãƒ ç·¨é›†
      if (pane.isHoldItem) {
        const holdItems = data.creative.holdItems || [];
        const currentItem = holdItems.find(i => i.id === pane.id) || pane;
        
        return (
          <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
            <textarea value={currentItem.content || ''} onChange={(e) => onUpdate(e.target.value)} placeholder="ã“ã“ã«åŸ·ç­†..." style={{ flex: 1, padding: '16px', background: theme.bg, border: 'none', outline: 'none', resize: 'none', fontSize: '14px', lineHeight: '1.8', color: theme.text, fontFamily: '"Noto Serif JP", serif' }} />
          </div>
        );
      }

      // é€šå¸¸ã‚¢ã‚¤ãƒ†ãƒ ç·¨é›†
      const charCount = (pane.content || '').replace(/[\s\n]/g, '').length;

      return (
        <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
          {pane.type === 'chapter' && (
            <div style={{ padding: '6px 12px', borderBottom: `1px solid ${theme.border}`, fontSize: '11px', color: theme.textSecondary, background: theme.bgSecondary, display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
              <span><span style={{ color: theme.accent, fontWeight: '600' }}>{charCount.toLocaleString()}</span> å­—</span>
              <button onClick={() => setShowReplace(!showReplace)} style={{ padding: '2px 8px', fontSize: '10px', background: showReplace ? theme.accent : theme.bgTertiary, color: showReplace ? '#fff' : theme.textSecondary, border: 'none', borderRadius: '3px', cursor: 'pointer' }}>ğŸ” ç½®æ›</button>
            </div>
          )}
          {showReplace && pane.type === 'chapter' && (
            <div style={{ padding: '8px 12px', borderBottom: `1px solid ${theme.border}`, background: theme.bgSecondary, display: 'flex', gap: '8px', alignItems: 'center', flexWrap: 'wrap' }}>
              <input type="text" value={searchText} onChange={(e) => setSearchText(e.target.value)} placeholder="æ¤œç´¢..." style={{ flex: 1, minWidth: '80px', padding: '4px 8px', fontSize: '11px', background: theme.bg, border: `1px solid ${theme.border}`, borderRadius: '4px', color: theme.text, outline: 'none' }} />
              <span style={{ color: theme.textSecondary }}>â†’</span>
              <input type="text" value={replaceText} onChange={(e) => setReplaceText(e.target.value)} placeholder="ç½®æ›..." style={{ flex: 1, minWidth: '80px', padding: '4px 8px', fontSize: '11px', background: theme.bg, border: `1px solid ${theme.border}`, borderRadius: '4px', color: theme.text, outline: 'none' }} />
              <button onClick={handleReplaceAll} style={{ padding: '4px 10px', fontSize: '10px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>å…¨ç½®æ›</button>
            </div>
          )}
          {pane.type === 'memo' ? (
            <div style={{ flex: 1, overflow: 'auto' }}>
              <OutlineEditor content={pane.content || ''} onChange={onUpdate} theme={theme} />
            </div>
          ) : (
            <textarea ref={textareaRef} value={pane.content || ''} onChange={(e) => onUpdate(e.target.value)} placeholder="ã“ã“ã«åŸ·ç­†..." style={{ flex: 1, padding: '16px', background: theme.bg, border: 'none', outline: 'none', resize: 'none', fontSize: '14px', lineHeight: '1.8', color: theme.text, fontFamily: '"Noto Serif JP", serif' }} />
          )}
        </div>
      );
    };

    // ==================== ã‚¨ãƒ‡ã‚£ã‚¿ ====================
    const Editor = ({ item, onUpdate, theme, data, setData }) => {
      const [showPreview, setShowPreview] = useState(false);
      const [showIdeaTagSelector, setShowIdeaTagSelector] = useState(false);

      if (!item) return <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: theme.textSecondary }}>å·¦ã®ãƒªã‚¹ãƒˆã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ã­</div>;

      // ãƒã‚¿ç·¨é›†ãƒ¢ãƒ¼ãƒ‰
      if (item.isIdea) {
        const ideas = data.creative.ideas || [];
        const currentIdea = ideas.find(i => i.id === item.id) || item;
        
        const updateIdea = (field, value) => {
          const newIdeas = ideas.map(i => i.id === item.id ? { ...i, [field]: value } : i);
          setData({ ...data, creative: { ...data.creative, ideas: newIdeas } });
        };

        const addTagToIdea = (tag) => {
          if (!(currentIdea.tags || []).includes(tag)) {
            updateIdea('tags', [...(currentIdea.tags || []), tag]);
          }
        };

        const removeTagFromIdea = (tag) => {
          updateIdea('tags', (currentIdea.tags || []).filter(t => t !== tag));
        };

        const statusLabels = { unused: 'æœªä½¿ç”¨', tweeted: 'ãƒ„ã‚¤ãƒãƒ™', posted: 'æŠ•ç¨¿æ¸ˆ', used: 'ä½¿ç”¨æ¸ˆ' };

        return (
          <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }} onClick={() => setShowIdeaTagSelector(false)}>
            <div style={{ padding: '12px 16px', borderBottom: `1px solid ${theme.border}`, display: 'flex', alignItems: 'center', gap: '12px', background: theme.bgSecondary }}>
              <Icons.Lightbulb />
              <span style={{ fontSize: '15px', fontWeight: '500' }}>{currentIdea.title}</span>
              <div style={{ flex: 1 }} />
              <select value={currentIdea.status} onChange={(e) => updateIdea('status', e.target.value)} style={{ padding: '6px 12px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '12px' }}>
                <option value="unused">æœªä½¿ç”¨</option>
                <option value="tweeted">ãƒ„ã‚¤ãƒãƒ™</option>
                <option value="posted">æŠ•ç¨¿æ¸ˆ</option>
                <option value="used">ä½¿ç”¨æ¸ˆ</option>
              </select>
            </div>
            {/* ã‚¿ã‚° */}
            <div style={{ padding: '12px 16px', borderBottom: `1px solid ${theme.border}`, display: 'flex', gap: '8px', alignItems: 'center', flexWrap: 'wrap', background: theme.bgSecondary }}>
              <Icons.Tag />
              {(currentIdea.tags || []).map(tag => (
                <span key={tag} style={{ fontSize: '11px', padding: '4px 8px', background: theme.accent, color: '#fff', borderRadius: '4px', display: 'flex', alignItems: 'center', gap: '4px' }}>
                  {tag}
                  <button onClick={() => removeTagFromIdea(tag)} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', padding: 0, display: 'flex' }}><Icons.X /></button>
                </span>
              ))}
              <div style={{ position: 'relative' }} onClick={(e) => e.stopPropagation()}>
                <button onClick={() => setShowIdeaTagSelector(!showIdeaTagSelector)} style={{ fontSize: '11px', padding: '4px 8px', background: theme.bgTertiary, color: theme.textSecondary, border: `1px dashed ${theme.border}`, borderRadius: '4px', cursor: 'pointer' }}>+ ã‚¿ã‚°è¿½åŠ </button>
                {showIdeaTagSelector && (
                  <div style={{ position: 'absolute', top: '100%', left: 0, background: theme.bgSecondary, border: `1px solid ${theme.border}`, borderRadius: '6px', padding: '8px', zIndex: 100, minWidth: '120px', boxShadow: '0 4px 12px rgba(0,0,0,0.2)' }}>
                    {data.tags.filter(t => !(currentIdea.tags || []).includes(t)).map(tag => (
                      <div key={tag} onClick={() => { addTagToIdea(tag); setShowIdeaTagSelector(false); }} style={{ padding: '4px 8px', fontSize: '11px', cursor: 'pointer', borderRadius: '4px', color: theme.text }} onMouseOver={(e) => e.target.style.background = theme.bgTertiary} onMouseOut={(e) => e.target.style.background = 'transparent'}>{tag}</div>
                    ))}
                  </div>
                )}
              </div>
            </div>
            <textarea value={currentIdea.content || ''} onChange={(e) => updateIdea('content', e.target.value)} placeholder="ãƒã‚¿ã®è©³ç´°ã‚’å…¥åŠ›...&#10;&#10;ã‚ã‚‰ã™ã˜ã€ã‚­ãƒ£ãƒ©è¨­å®šã€ã‚·ãƒ¼ãƒ³ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãªã©è‡ªç”±ã«æ›¸ã„ã¦ã­" style={{ flex: 1, padding: '20px 24px', background: theme.bg, border: 'none', outline: 'none', resize: 'none', fontSize: '14px', lineHeight: '1.8', color: theme.text, fontFamily: '"Noto Serif JP", serif' }} />
          </div>
        );
      }

      // é€šå¸¸ã®ä½œå“ç·¨é›†ãƒ¢ãƒ¼ãƒ‰
      const charCount = (item.content || '').replace(/[\s\n]/g, '').length;

      const updateContent = (content) => {
        onUpdate(item.id, content);
      };

      return (
        <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
          <div style={{ padding: '12px 16px', borderBottom: `1px solid ${theme.border}`, display: 'flex', alignItems: 'center', justifyContent: 'space-between', background: theme.bgSecondary }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
              <span style={{ fontSize: '15px', fontWeight: '500' }}>{item.name}</span>
              {item.type === 'chapter' && <span style={{ fontSize: '12px', color: theme.textSecondary }}><span style={{ color: theme.accent, fontWeight: '600' }}>{charCount.toLocaleString()}</span> å­—</span>}
              {item.type === 'memo' && <span style={{ fontSize: '10px', padding: '2px 8px', background: theme.bgTertiary, borderRadius: '4px', color: theme.textSecondary }}>ã‚«ã‚¦ãƒ³ãƒˆå¯¾è±¡å¤–</span>}
            </div>
            <button onClick={() => setShowPreview(true)} style={{ padding: '6px 12px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '12px', display: 'flex', alignItems: 'center', gap: '6px' }}><Icons.Eye /> ç¸¦æ›¸ã</button>
          </div>
          <div style={{ flex: 1, overflow: 'auto', background: theme.bg }}>
            {item.type === 'memo' ? (
              <OutlineEditor content={item.content || ''} onChange={updateContent} theme={theme} />
            ) : (
              <textarea value={item.content || ''} onChange={(e) => updateContent(e.target.value)} placeholder="ã“ã“ã«åŸ·ç­†..." style={{ width: '100%', height: '100%', padding: '24px', background: 'transparent', border: 'none', outline: 'none', resize: 'none', fontSize: '15px', lineHeight: '2', color: theme.text, fontFamily: '"Noto Serif JP", serif' }} />
            )}
          </div>
          {showPreview && (
            <div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.8)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 }} onClick={() => setShowPreview(false)}>
              <div style={{ background: theme.bgSecondary, borderRadius: '12px', width: '90%', height: '85%', maxWidth: '900px', overflow: 'hidden', display: 'flex', flexDirection: 'column' }} onClick={(e) => e.stopPropagation()}>
                <div style={{ padding: '16px 20px', borderBottom: `1px solid ${theme.border}`, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <span style={{ fontWeight: '500' }}>ç¸¦æ›¸ããƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
                  <button onClick={() => setShowPreview(false)} style={{ background: 'none', border: 'none', color: theme.text, cursor: 'pointer', padding: '4px' }}><Icons.X /></button>
                </div>
                <div style={{ flex: 1, padding: '40px', overflow: 'auto' }}>
                  <div style={{ writingMode: 'vertical-rl', textOrientation: 'mixed', height: '100%', fontFamily: '"Noto Serif JP", serif', fontSize: '16px', lineHeight: '2.2', color: theme.text, whiteSpace: 'pre-wrap' }}>{item.content || 'ï¼ˆå†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“ï¼‰'}</div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    // ==================== ãƒã‚¿ä¿ç®¡åº«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ====================
    const IdeasSection = ({ data, setData, theme }) => {
      const [selectedIdea, setSelectedIdea] = useState(null);
      const [editingId, setEditingId] = useState(null);
      const [filter, setFilter] = useState('all'); // all, unused, posted, used

      const ideas = data.creative.ideas || [];

      const addIdea = () => {
        const newIdea = {
          id: `idea-${Date.now()}`,
          title: 'æ–°ã—ã„ãƒã‚¿',
          content: '',
          tags: [],
          status: 'unused', // unused | posted | used
          createdAt: new Date().toISOString()
        };
        setData({ ...data, creative: { ...data.creative, ideas: [newIdea, ...ideas] } });
        setSelectedIdea(newIdea);
      };

      const updateIdea = (id, field, value) => {
        const newIdeas = ideas.map(i => i.id === id ? { ...i, [field]: value } : i);
        setData({ ...data, creative: { ...data.creative, ideas: newIdeas } });
        if (selectedIdea?.id === id) setSelectedIdea({ ...selectedIdea, [field]: value });
      };

      const deleteIdea = (id) => {
        if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          setData({ ...data, creative: { ...data.creative, ideas: ideas.filter(i => i.id !== id) } });
          if (selectedIdea?.id === id) setSelectedIdea(null);
        }
      };

      const addTagToIdea = (ideaId, tag) => {
        const idea = ideas.find(i => i.id === ideaId);
        if (idea && !idea.tags.includes(tag)) {
          updateIdea(ideaId, 'tags', [...idea.tags, tag]);
        }
      };

      const removeTagFromIdea = (ideaId, tag) => {
        const idea = ideas.find(i => i.id === ideaId);
        if (idea) {
          updateIdea(ideaId, 'tags', idea.tags.filter(t => t !== tag));
        }
      };

      const filteredIdeas = ideas.filter(i => {
        if (filter === 'all') return true;
        return i.status === filter;
      });

      const statusLabels = { unused: 'æœªä½¿ç”¨', tweeted: 'ãƒ„ã‚¤ãƒãƒ™', posted: 'æŠ•ç¨¿æ¸ˆ', used: 'ä½¿ç”¨æ¸ˆ' };
      const statusColors = { unused: theme.accent, tweeted: theme.warning, posted: '#9b59b6', used: theme.success };

      return (
        <div style={{ display: 'flex', height: '100%' }}>
          {/* ãƒªã‚¹ãƒˆ */}
          <div style={{ width: '320px', borderRight: `1px solid ${theme.border}`, display: 'flex', flexDirection: 'column', background: theme.bgSecondary }}>
            <div style={{ padding: '16px', borderBottom: `1px solid ${theme.border}` }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                <span style={{ fontWeight: '600' }}>ğŸ’¡ ãƒã‚¿ä¿ç®¡åº«</span>
                <button onClick={addIdea} style={{ padding: '6px 12px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '12px', display: 'flex', alignItems: 'center', gap: '4px' }}><Icons.Plus /> è¿½åŠ </button>
              </div>
              <div style={{ display: 'flex', gap: '4px' }}>
                {['all', 'unused', 'tweeted', 'posted', 'used'].map(f => (
                  <button key={f} onClick={() => setFilter(f)} style={{ flex: 1, padding: '6px', fontSize: '10px', background: filter === f ? theme.accent : theme.bgTertiary, color: filter === f ? '#fff' : theme.textSecondary, border: 'none', borderRadius: '4px', cursor: 'pointer' }}>
                    {f === 'all' ? 'ã™ã¹ã¦' : statusLabels[f]}
                  </button>
                ))}
              </div>
            </div>
            <div style={{ flex: 1, overflow: 'auto', padding: '8px' }}>
              {filteredIdeas.map(idea => (
                <div key={idea.id} onClick={() => setSelectedIdea(idea)} style={{ padding: '12px', marginBottom: '4px', borderRadius: '8px', cursor: 'pointer', background: selectedIdea?.id === idea.id ? theme.highlight : 'transparent', border: `1px solid ${selectedIdea?.id === idea.id ? theme.accent : 'transparent'}` }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '6px' }}>
                    {editingId === idea.id ? (
                      <input type="text" value={idea.title} onChange={(e) => updateIdea(idea.id, 'title', e.target.value)} onBlur={() => setEditingId(null)} onKeyDown={(e) => e.key === 'Enter' && setEditingId(null)} autoFocus onClick={(e) => e.stopPropagation()} style={{ flex: 1, background: theme.bg, border: `1px solid ${theme.accent}`, borderRadius: '4px', padding: '2px 6px', color: theme.text, fontSize: '13px', outline: 'none' }} />
                    ) : (
                      <span onDoubleClick={(e) => { e.stopPropagation(); setEditingId(idea.id); }} style={{ flex: 1, fontWeight: '500', fontSize: '13px' }}>{idea.title}</span>
                    )}
                    <span style={{ fontSize: '10px', padding: '2px 6px', background: statusColors[idea.status], color: '#fff', borderRadius: '4px' }}>
                      {statusLabels[idea.status]}
                    </span>
                  </div>
                  {/* ã‚¿ã‚°è¡¨ç¤º */}
                  <div style={{ display: 'flex', gap: '4px', flexWrap: 'wrap' }}>
                    {idea.tags.map(tag => (
                      <span key={tag} style={{ fontSize: '10px', padding: '2px 6px', background: theme.bgTertiary, borderRadius: '4px', color: theme.textSecondary }}>{tag}</span>
                    ))}
                  </div>
                  {idea.content && (
                    <div style={{ fontSize: '11px', color: theme.textSecondary, marginTop: '6px', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>
                      {idea.content.substring(0, 50)}...
                    </div>
                  )}
                </div>
              ))}
              {filteredIdeas.length === 0 && <div style={{ textAlign: 'center', color: theme.textSecondary, padding: '40px 20px', fontSize: '13px' }}>ãƒã‚¿ãŒã‚ã‚Šã¾ã›ã‚“<br/>ã€Œ+ è¿½åŠ ã€ã§ä½œæˆã—ã¦ã­</div>}
            </div>
          </div>

          {/* ã‚¨ãƒ‡ã‚£ã‚¿ */}
          <div style={{ flex: 1, display: 'flex', flexDirection: 'column', background: theme.bg }}>
            {selectedIdea ? (
              <>
                <div style={{ padding: '12px 16px', borderBottom: `1px solid ${theme.border}`, display: 'flex', alignItems: 'center', gap: '12px', background: theme.bgSecondary }}>
                  <span style={{ fontWeight: '500', fontSize: '15px' }}>{selectedIdea.title}</span>
                  <div style={{ flex: 1 }} />
                  <select value={selectedIdea.status} onChange={(e) => updateIdea(selectedIdea.id, 'status', e.target.value)} style={{ padding: '6px 12px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '12px' }}>
                    <option value="unused">æœªä½¿ç”¨</option>
                    <option value="tweeted">ãƒ„ã‚¤ãƒãƒ™</option>
                    <option value="posted">æŠ•ç¨¿æ¸ˆ</option>
                    <option value="used">ä½¿ç”¨æ¸ˆ</option>
                  </select>
                  <button onClick={() => deleteIdea(selectedIdea.id)} style={{ padding: '6px 12px', background: theme.error, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '12px' }}>å‰Šé™¤</button>
                </div>
                {/* ã‚¿ã‚° */}
                <div style={{ padding: '12px 16px', borderBottom: `1px solid ${theme.border}`, display: 'flex', gap: '8px', alignItems: 'center', flexWrap: 'wrap', background: theme.bgSecondary }}>
                  <Icons.Tag />
                  {selectedIdea.tags.map(tag => (
                    <span key={tag} style={{ fontSize: '11px', padding: '4px 8px', background: theme.accent, color: '#fff', borderRadius: '4px', display: 'flex', alignItems: 'center', gap: '4px' }}>
                      {tag}
                      <button onClick={() => removeTagFromIdea(selectedIdea.id, tag)} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', padding: 0, display: 'flex' }}><Icons.X /></button>
                    </span>
                  ))}
                  <select value="" onChange={(e) => { if (e.target.value) addTagToIdea(selectedIdea.id, e.target.value); }} style={{ padding: '4px 8px', fontSize: '11px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '4px', color: theme.text, cursor: 'pointer' }}>
                    <option value="">+ ã‚¿ã‚°è¿½åŠ </option>
                    {data.tags.filter(t => !selectedIdea.tags.includes(t)).map(t => <option key={t} value={t}>{t}</option>)}
                  </select>
                </div>
                <textarea value={selectedIdea.content} onChange={(e) => updateIdea(selectedIdea.id, 'content', e.target.value)} placeholder="ãƒã‚¿ã®è©³ç´°ã‚’å…¥åŠ›...&#10;&#10;ã‚ã‚‰ã™ã˜ã€ã‚­ãƒ£ãƒ©è¨­å®šã€ã‚·ãƒ¼ãƒ³ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãªã©è‡ªç”±ã«æ›¸ã„ã¦ã­" style={{ flex: 1, padding: '20px 24px', background: 'transparent', border: 'none', outline: 'none', resize: 'none', fontSize: '14px', lineHeight: '1.8', color: theme.text, fontFamily: '"Noto Serif JP", serif' }} />
              </>
            ) : (
              <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: theme.textSecondary }}>ãƒã‚¿ã‚’é¸æŠã—ã¦ã­</div>
            )}
          </div>
        </div>
      );
    };

    // ==================== è¨­å®šç”»é¢ ====================
    const SettingsScreen = ({ data, setData, theme, syncSettings, setSyncSettings, onSaveToGist, onLoadFromGist, syncStatus }) => {
      const inputTags = data.inputTags || ['å°èª¬', 'æ¼«ç”»', 'Audible', 'æ˜ ç”»', 'ãƒ‰ãƒ©ãƒ', 'ã‚¢ãƒ‹ãƒ¡', 'YouTube'];
      const dailyTags = data.dailyTags || ['ä»•äº‹', 'è²·ã„ç‰©', 'ã‚¢ã‚¤ãƒ‡ã‚¢', 'æ—¥è¨˜'];
      const [showToken, setShowToken] = useState(false);
      const [showPassword, setShowPassword] = useState(false);
      const [newPassword, setNewPassword] = useState('');
      const [confirmPassword, setConfirmPassword] = useState('');
      
      const handlePasswordChange = async () => {
        if (!newPassword) {
          alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
        if (newPassword !== confirmPassword) {
          alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“');
          return;
        }
        if (newPassword.length < 4) {
          alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯4æ–‡å­—ä»¥ä¸Šã«ã—ã¦ãã ã•ã„');
          return;
        }
        const hash = await CryptoUtils.hashPassword(newPassword);
        setSyncSettings(prev => ({ ...prev, passwordHash: hash, password: newPassword }));
        localStorage.setItem('noteAppPasswordHash', hash);
        // rememberPasswordãŒONãªã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚‚ä¿å­˜
        if (syncSettings.rememberPassword) {
          localStorage.setItem('noteAppSavedPw', newPassword);
        }
        setNewPassword('');
        setConfirmPassword('');
        alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã—ãŸï¼');
      };
      
      return (
        <div style={{ padding: '24px', height: '100%', overflow: 'auto' }}>
          <h2 style={{ fontSize: '20px', fontWeight: '600', marginBottom: '24px', color: theme.text }}>âš™ï¸ è¨­å®š</h2>
          
          {/* ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ */}
          <div style={{ background: theme.bgSecondary, borderRadius: '12px', padding: '20px', marginBottom: '16px', border: `1px solid ${theme.accent}` }}>
            <h3 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '8px' }}><Icons.Cloud /> ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸï¼ˆGitHub Gistï¼‰</h3>
            <p style={{ fontSize: '12px', color: theme.textSecondary, marginBottom: '16px' }}>
              ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã—ã¦GitHub Gistã«ä¿å­˜ã—ã€è¤‡æ•°ç«¯æœ«ã§åŒæœŸã§ãã¾ã™ã€‚<br/>
              <span style={{ color: theme.accent }}>â€» ãƒ‡ãƒ¼ã‚¿ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§æš—å·åŒ–ã•ã‚Œã‚‹ã®ã§ã€Gistã‚’è¦‹ã‚‰ã‚Œã¦ã‚‚ä¸­èº«ã¯èª­ã‚ã¾ã›ã‚“</span>
            </p>
            
            {/* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š */}
            <div style={{ background: theme.bg, borderRadius: '8px', padding: '16px', marginBottom: '16px' }}>
              <h4 style={{ fontSize: '13px', fontWeight: '600', marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '6px' }}><Icons.Lock /> æš—å·åŒ–ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</h4>
              <p style={{ fontSize: '11px', color: theme.textSecondary, marginBottom: '12px' }}>
                {syncSettings.passwordHash ? 'âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šæ¸ˆã¿ï¼ˆå¤‰æ›´ã™ã‚‹å ´åˆã¯ä¸‹ã«å…¥åŠ›ï¼‰' : 'âš ï¸ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æœªè¨­å®šï¼ˆåŒæœŸã‚’ä½¿ã†ã«ã¯è¨­å®šãŒå¿…è¦ã§ã™ï¼‰'}
              </p>
              <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '8px' }}>
                <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                  <div style={{ position: 'relative', flex: 1, minWidth: '140px' }}>
                    <input 
                      type={showPassword ? 'text' : 'password'}
                      value={newPassword}
                      onChange={(e) => setNewPassword(e.target.value)}
                      placeholder="æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                      style={{ width: '100%', padding: '8px 36px 8px 12px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '13px', outline: 'none', boxSizing: 'border-box' }}
                    />
                    <button onClick={() => setShowPassword(!showPassword)} style={{ position: 'absolute', right: '8px', top: '50%', transform: 'translateY(-50%)', background: 'none', border: 'none', color: theme.textSecondary, cursor: 'pointer', padding: '4px' }}>
                      {showPassword ? <Icons.EyeOff /> : <Icons.Eye />}
                    </button>
                  </div>
                  <input 
                    type={showPassword ? 'text' : 'password'}
                    value={confirmPassword}
                    onChange={(e) => setConfirmPassword(e.target.value)}
                    placeholder="ç¢ºèªç”¨"
                    style={{ flex: 1, minWidth: '100px', padding: '8px 12px', background: theme.bgTertiary, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '13px', outline: 'none', boxSizing: 'border-box' }}
                  />
                  <button onClick={handlePasswordChange} style={{ padding: '8px 16px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '12px', whiteSpace: 'nowrap' }}>è¨­å®š</button>
                </div>
              </div>
              <label style={{ display: 'flex', alignItems: 'center', gap: '8px', fontSize: '11px', color: theme.textSecondary, cursor: 'pointer' }}>
                <input 
                  type="checkbox" 
                  checked={syncSettings.rememberPassword}
                  onChange={(e) => {
                    setSyncSettings(prev => ({ ...prev, rememberPassword: e.target.checked }));
                    if (e.target.checked) {
                      localStorage.setItem('noteAppRememberPw', 'true');
                      // ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒã‚ã‚Œã°ä¿å­˜
                      if (syncSettings.password) {
                        localStorage.setItem('noteAppSavedPw', syncSettings.password);
                      }
                    } else {
                      localStorage.removeItem('noteAppRememberPw');
                      localStorage.removeItem('noteAppSavedPw');
                    }
                  }}
                />
                ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨˜æ†¶ã™ã‚‹ï¼ˆæ¬¡å›èµ·å‹•æ™‚ã«å…¥åŠ›ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼†åŒæœŸæ™‚ã‚‚å…¥åŠ›ä¸è¦ï¼‰
              </label>
            </div>
            
            {/* GitHub Token */}
            <div style={{ marginBottom: '12px' }}>
              <label style={{ fontSize: '12px', color: theme.textSecondary, display: 'block', marginBottom: '4px' }}>GitHub Personal Access Token</label>
              <div style={{ display: 'flex', gap: '8px' }}>
                <div style={{ position: 'relative', flex: 1 }}>
                  <input 
                    type={showToken ? 'text' : 'password'}
                    value={syncSettings.githubToken || ''}
                    onChange={(e) => {
                      setSyncSettings(prev => ({ ...prev, githubToken: e.target.value }));
                      localStorage.setItem('noteAppGithubToken', e.target.value);
                    }}
                    placeholder="ghp_xxxxxxxxxxxx"
                    style={{ width: '100%', padding: '8px 36px 8px 12px', background: theme.bg, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '12px', outline: 'none', fontFamily: 'monospace' }}
                  />
                  <button onClick={() => setShowToken(!showToken)} style={{ position: 'absolute', right: '8px', top: '50%', transform: 'translateY(-50%)', background: 'none', border: 'none', color: theme.textSecondary, cursor: 'pointer' }}>
                    {showToken ? <Icons.EyeOff /> : <Icons.Eye />}
                  </button>
                </div>
              </div>
              <p style={{ fontSize: '10px', color: theme.textSecondary, marginTop: '4px' }}>
                <a href="https://github.com/settings/tokens/new?scopes=gist&description=NoteApp" target="_blank" rel="noopener" style={{ color: theme.accent }}>ã“ã¡ã‚‰ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œ</a>ï¼ˆgist ã‚¹ã‚³ãƒ¼ãƒ—ã®ã¿å¿…è¦ï¼‰
              </p>
            </div>
            
            {/* Gist ID */}
            <div style={{ marginBottom: '16px' }}>
              <label style={{ fontSize: '12px', color: theme.textSecondary, display: 'block', marginBottom: '4px' }}>Gist IDï¼ˆåˆå›ä¿å­˜å¾Œã«è‡ªå‹•è¨­å®š / ä»–ç«¯æœ«ã§ä½¿ã†å ´åˆã¯ã‚³ãƒ”ãƒšï¼‰</label>
              <input 
                type="text"
                value={syncSettings.gistId || ''}
                onChange={(e) => {
                  setSyncSettings(prev => ({ ...prev, gistId: e.target.value }));
                  localStorage.setItem('noteAppGistId', e.target.value);
                }}
                placeholder="åˆå›ä¿å­˜æ™‚ã«è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™"
                style={{ width: '100%', padding: '8px 12px', background: theme.bg, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '12px', outline: 'none', fontFamily: 'monospace' }}
              />
            </div>
            
            {/* åŒæœŸãƒœã‚¿ãƒ³ */}
            <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap' }}>
              <button 
                onClick={onSaveToGist}
                disabled={!syncSettings.githubToken || !syncSettings.passwordHash || syncStatus === 'saving'}
                style={{ 
                  padding: '10px 20px', 
                  background: (!syncSettings.githubToken || !syncSettings.passwordHash) ? theme.bgTertiary : theme.success, 
                  color: (!syncSettings.githubToken || !syncSettings.passwordHash) ? theme.textSecondary : '#fff', 
                  border: 'none', borderRadius: '8px', cursor: (!syncSettings.githubToken || !syncSettings.passwordHash) ? 'not-allowed' : 'pointer', 
                  fontSize: '13px', display: 'flex', alignItems: 'center', gap: '8px',
                  opacity: syncStatus === 'saving' ? 0.7 : 1
                }}
              >
                <Icons.CloudUpload /> {syncStatus === 'saving' ? 'ä¿å­˜ä¸­...' : 'Gistã«ä¿å­˜'}
              </button>
              <button 
                onClick={onLoadFromGist}
                disabled={!syncSettings.githubToken || !syncSettings.gistId || !syncSettings.passwordHash || syncStatus === 'loading'}
                style={{ 
                  padding: '10px 20px', 
                  background: (!syncSettings.githubToken || !syncSettings.gistId || !syncSettings.passwordHash) ? theme.bgTertiary : theme.accent, 
                  color: (!syncSettings.githubToken || !syncSettings.gistId || !syncSettings.passwordHash) ? theme.textSecondary : '#fff', 
                  border: 'none', borderRadius: '8px', cursor: (!syncSettings.githubToken || !syncSettings.gistId || !syncSettings.passwordHash) ? 'not-allowed' : 'pointer', 
                  fontSize: '13px', display: 'flex', alignItems: 'center', gap: '8px',
                  opacity: syncStatus === 'loading' ? 0.7 : 1
                }}
              >
                <Icons.CloudDownload /> {syncStatus === 'loading' ? 'èª­ã¿è¾¼ã¿ä¸­...' : 'Gistã‹ã‚‰èª­ã¿è¾¼ã¿'}
              </button>
            </div>
            {syncStatus === 'saved' && <p style={{ fontSize: '11px', color: theme.success, marginTop: '8px' }}>âœ… ä¿å­˜å®Œäº†ï¼</p>}
            {syncStatus === 'loaded' && <p style={{ fontSize: '11px', color: theme.success, marginTop: '8px' }}>âœ… èª­ã¿è¾¼ã¿å®Œäº†ï¼</p>}
            {syncStatus === 'error' && <p style={{ fontSize: '11px', color: theme.error, marginTop: '8px' }}>âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</p>}
          </div>
          
          {/* Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */}
          <div style={{ background: theme.bgSecondary, borderRadius: '12px', padding: '20px', marginBottom: '16px', border: `1px solid ${theme.border}` }}>
            <h3 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '8px' }}><Icons.Calendar /> Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åŸ‹ã‚è¾¼ã¿</h3>
            <p style={{ fontSize: '12px', color: theme.textSecondary, marginBottom: '12px' }}>
              Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ã­ã€‚<br/>
              ï¼ˆGoogleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ â†’ è¨­å®š â†’ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®çµ±åˆ â†’ åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ï¼‰<br/>
              <span style={{ color: theme.accent }}>â€» ãƒ›ãƒ¼ãƒ ç”»é¢ã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆï¼</span>
            </p>
            <textarea 
              value={data.settings.calendarEmbed || ''} 
              onChange={(e) => setData({...data, settings: {...data.settings, calendarEmbed: e.target.value}})}
              placeholder='<iframe src="https://calendar.google.com/..." ...></iframe>'
              style={{ width: '100%', height: '100px', padding: '12px', background: theme.bg, border: `1px solid ${theme.border}`, borderRadius: '8px', color: theme.text, fontSize: '12px', resize: 'vertical', outline: 'none', fontFamily: 'monospace' }}
            />
          </div>

          {/* å‰µä½œã‚¿ã‚°ç®¡ç† */}
          <div style={{ background: theme.bgSecondary, borderRadius: '12px', padding: '20px', marginBottom: '16px', border: `1px solid ${theme.border}` }}>
            <h3 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '8px' }}><Icons.Tag /> å‰µä½œã‚¿ã‚°ç®¡ç†</h3>
            <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap', marginBottom: '12px' }}>
              {data.tags.map((tag, i) => (
                <span key={tag} style={{ display: 'flex', alignItems: 'center', gap: '4px', padding: '6px 10px', background: theme.tagColors[i % theme.tagColors.length], color: '#fff', borderRadius: '6px', fontSize: '12px' }}>
                  {tag}
                  <button onClick={() => setData({...data, tags: data.tags.filter(t => t !== tag)})} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', padding: 0, display: 'flex', opacity: 0.8 }}><Icons.X /></button>
                </span>
              ))}
            </div>
            <div style={{ display: 'flex', gap: '8px' }}>
              <input type="text" id="newTagInput" placeholder="æ–°ã—ã„ã‚¿ã‚°..." style={{ flex: 1, padding: '8px 12px', background: theme.bg, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '13px', outline: 'none' }} />
              <button onClick={() => {
                const input = document.getElementById('newTagInput');
                if (input.value.trim() && !data.tags.includes(input.value.trim())) {
                  setData({...data, tags: [...data.tags, input.value.trim()]});
                  input.value = '';
                }
              }} style={{ padding: '8px 16px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '13px' }}>è¿½åŠ </button>
            </div>
          </div>

          {/* æ—¥å¸¸ãƒ¡ãƒ¢ã‚¿ã‚°ç®¡ç† */}
          <div style={{ background: theme.bgSecondary, borderRadius: '12px', padding: '20px', marginBottom: '16px', border: `1px solid ${theme.border}` }}>
            <h3 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '8px' }}><Icons.FileText /> æ—¥å¸¸ãƒ¡ãƒ¢ã‚¿ã‚°ç®¡ç†</h3>
            <p style={{ fontSize: '12px', color: theme.textSecondary, marginBottom: '12px' }}>
              æ—¥å¸¸ãƒ¡ãƒ¢ã®åˆ†é¡ã«ä½¿ã†ã‚¿ã‚°ã‚’ç®¡ç†ã§ãã‚‹ã‚ˆ
            </p>
            <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap', marginBottom: '12px' }}>
              {dailyTags.map((tag, i) => (
                <span key={tag} style={{ display: 'flex', alignItems: 'center', gap: '4px', padding: '6px 10px', background: theme.success, color: '#fff', borderRadius: '6px', fontSize: '12px' }}>
                  {tag}
                  <button onClick={() => setData({...data, dailyTags: dailyTags.filter(t => t !== tag)})} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', padding: 0, display: 'flex', opacity: 0.8 }}><Icons.X /></button>
                </span>
              ))}
            </div>
            <div style={{ display: 'flex', gap: '8px' }}>
              <input type="text" id="newDailyTagInput" placeholder="æ–°ã—ã„æ—¥å¸¸ã‚¿ã‚°..." style={{ flex: 1, padding: '8px 12px', background: theme.bg, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '13px', outline: 'none' }} />
              <button onClick={() => {
                const input = document.getElementById('newDailyTagInput');
                if (input.value.trim() && !dailyTags.includes(input.value.trim())) {
                  setData({...data, dailyTags: [...dailyTags, input.value.trim()]});
                  input.value = '';
                  input.value = '';
                }
              }} style={{ padding: '8px 16px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '13px' }}>è¿½åŠ </button>
            </div>
          </div>

          {/* Inputã‚¿ã‚°ç®¡ç† */}
          <div style={{ background: theme.bgSecondary, borderRadius: '12px', padding: '20px', marginBottom: '16px', border: `1px solid ${theme.border}` }}>
            <h3 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '8px' }}><Icons.Book /> Inputã‚¿ã‚°ç®¡ç†</h3>
            <p style={{ fontSize: '12px', color: theme.textSecondary, marginBottom: '12px' }}>
              èª­æ›¸ãƒ»æ˜ ç”»ãªã©ã®è¨˜éŒ²ã«ä½¿ã†ã‚¿ã‚°ã‚’ç®¡ç†ã§ãã‚‹ã‚ˆ
            </p>
            <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap', marginBottom: '12px' }}>
              {inputTags.map((tag, i) => (
                <span key={tag} style={{ display: 'flex', alignItems: 'center', gap: '4px', padding: '6px 10px', background: theme.accentLight, color: '#fff', borderRadius: '6px', fontSize: '12px' }}>
                  {tag}
                  <button onClick={() => setData({...data, inputTags: inputTags.filter(t => t !== tag)})} style={{ background: 'none', border: 'none', color: '#fff', cursor: 'pointer', padding: 0, display: 'flex', opacity: 0.8 }}><Icons.X /></button>
                </span>
              ))}
            </div>
            <div style={{ display: 'flex', gap: '8px' }}>
              <input type="text" id="newInputTagInput" placeholder="æ–°ã—ã„Inputã‚¿ã‚°..." style={{ flex: 1, padding: '8px 12px', background: theme.bg, border: `1px solid ${theme.border}`, borderRadius: '6px', color: theme.text, fontSize: '13px', outline: 'none' }} />
              <button onClick={() => {
                const input = document.getElementById('newInputTagInput');
                if (input.value.trim() && !inputTags.includes(input.value.trim())) {
                  setData({...data, inputTags: [...inputTags, input.value.trim()]});
                  input.value = '';
                }
              }} style={{ padding: '8px 16px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '13px' }}>è¿½åŠ </button>
            </div>
          </div>

          {/* ãƒ‡ãƒ¼ã‚¿ç®¡ç† */}
          <div style={{ background: theme.bgSecondary, borderRadius: '12px', padding: '20px', border: `1px solid ${theme.border}` }}>
            <h3 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '12px' }}>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
            <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap' }}>
              <button onClick={() => {
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `note-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
              }} style={{ padding: '10px 20px', background: theme.accent, color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', fontSize: '13px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                <Icons.Download /> ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ(JSON)
              </button>
              <button onClick={() => {
                // å…¨ä½œå“ã‚’TXTã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                const allProjects = [...(data.creative.inProgress || []), ...(data.creative.completed || []), ...(data.creative.onHold || [])];
                let txtContent = '';
                allProjects.forEach(project => {
                  txtContent += 'â•'.repeat(50) + '\n';
                  txtContent += `ã€${project.name}ã€‘\n`;
                  txtContent += 'â•'.repeat(50) + '\n\n';
                  const chapters = project.items.filter(i => i.type === 'chapter');
                  chapters.forEach(chapter => {
                    txtContent += `â”€â”€ ${chapter.name} â”€â”€\n\n`;
                    txtContent += (chapter.content || '') + '\n\n';
                  });
                  txtContent += '\n\n';
                });
                const blob = new Blob([txtContent], { type: 'text/plain; charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ä½œå“ä¸€æ‹¬_${new Date().toISOString().split('T')[0]}.txt`;
                a.click();
                URL.revokeObjectURL(url);
              }} style={{ padding: '10px 20px', background: theme.success, color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', fontSize: '13px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                <Icons.Download /> ä½œå“ä¸€æ‹¬DL(TXT)
              </button>
              <label style={{ padding: '10px 20px', background: theme.bgTertiary, color: theme.text, border: `1px solid ${theme.border}`, borderRadius: '8px', cursor: 'pointer', fontSize: '13px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                <Icons.Upload /> ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                <input type="file" accept=".json" onChange={(e) => {
                  const file = e.target.files[0];
                  if (file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                      try {
                        const imported = JSON.parse(ev.target.result);
                        if (imported.creative) { setData(imported); alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ï¼'); }
                        else { alert('ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«ã§ã™'); }
                      } catch { alert('èª­ã¿è¾¼ã¿å¤±æ•—'); }
                    };
                    reader.readAsText(file);
                  }
                  e.target.value = '';
                }} style={{ display: 'none' }} />
              </label>
              <button onClick={() => {
                if (confirm('ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆå…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã¾ã™ï¼‰')) {
                  localStorage.removeItem('noteAppDataV2');
                  location.reload();
                }
              }} style={{ padding: '10px 20px', background: theme.error, color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', fontSize: '13px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ
              </button>
            </div>
            <p style={{ fontSize: '11px', color: theme.textSecondary, marginTop: '12px' }}>
              â€» ã‚¿ã‚°ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€Œãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆã€ã§åˆæœŸåŒ–ã—ã¦ãã ã•ã„
            </p>
          </div>
        </div>
      );
    };

    // ==================== ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª ====================
    function NoteApp() {
      const [darkMode, setDarkMode] = useState(true);
      const [currentSection, setCurrentSection] = useState('home');
      const [openPanes, setOpenPanes] = useState([]); // é–‹ã„ã¦ã„ã‚‹ãƒšã‚¤ãƒ³ï¼ˆæœ€å¤§3ã¤ï¼‰
      const [activePaneId, setActivePaneId] = useState(null); // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒšã‚¤ãƒ³ã®ID
      const [paneWidths, setPaneWidths] = useState({}); // å„ãƒšã‚¤ãƒ³ã®å¹…ï¼ˆflexå€¤ï¼‰
      const [resizingPane, setResizingPane] = useState(null); // ãƒªã‚µã‚¤ã‚ºä¸­ã®ãƒšã‚¤ãƒ³ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
      const [sidebarWidth, setSidebarWidth] = useState(280);
      const [isResizing, setIsResizing] = useState(false);
      
      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿è­·é–¢é€£
      const [isUnlocked, setIsUnlocked] = useState(false);
      const [passwordInput, setPasswordInput] = useState('');
      const [passwordError, setPasswordError] = useState('');
      const [showPasswordInput, setShowPasswordInput] = useState(false);
      const [secretTapCount, setSecretTapCount] = useState(0); // ç§˜å¯†ã®5å›ã‚¿ãƒƒãƒ—ç”¨
      
      // åŒæœŸè¨­å®š
      const [syncSettings, setSyncSettings] = useState(() => ({
        githubToken: localStorage.getItem('noteAppGithubToken') || '',
        gistId: localStorage.getItem('noteAppGistId') || '',
        passwordHash: localStorage.getItem('noteAppPasswordHash') || '',
        rememberPassword: localStorage.getItem('noteAppRememberPw') === 'true',
        password: localStorage.getItem('noteAppRememberPw') === 'true' ? (localStorage.getItem('noteAppSavedPw') || '') : '', // è¨˜æ†¶ONãªã‚‰ä¿å­˜ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã¿
      }));
      const [syncStatus, setSyncStatus] = useState(''); // '', 'saving', 'saved', 'loading', 'loaded', 'error'
      
      // èµ·å‹•æ™‚ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
      useEffect(() => {
        const checkPassword = async () => {
          const savedHash = localStorage.getItem('noteAppPasswordHash');
          const rememberPw = localStorage.getItem('noteAppRememberPw') === 'true';
          const hasData = localStorage.getItem('noteAppDataV2');
          
          if (!savedHash && !hasData) {
            // æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æœªè¨­å®šã€ãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰â†’ ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’ç¶­æŒï¼ˆ5å›ã‚¿ãƒƒãƒ—å¿…è¦ï¼‰
            setIsUnlocked(false);
          } else if (!savedHash) {
            // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æœªè¨­å®šã ãŒãƒ‡ãƒ¼ã‚¿ã‚ã‚Š â†’ ã‚¢ãƒ³ãƒ­ãƒƒã‚¯
            setIsUnlocked(true);
          } else if (rememberPw) {
            // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨˜æ†¶ãŒON â†’ ã‚¢ãƒ³ãƒ­ãƒƒã‚¯
            setIsUnlocked(true);
          } else {
            // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ãŒå¿…è¦
            setIsUnlocked(false);
          }
        };
        checkPassword();
      }, []);
      
      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
      const handlePasswordSubmit = async () => {
        if (!passwordInput) {
          setPasswordError('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
        
        try {
          const inputHash = await CryptoUtils.hashPassword(passwordInput);
          if (inputHash === syncSettings.passwordHash) {
            setSyncSettings(prev => ({ ...prev, password: passwordInput }));
            // rememberPasswordãŒONãªã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚‚ä¿å­˜
            if (syncSettings.rememberPassword) {
              localStorage.setItem('noteAppSavedPw', passwordInput);
            }
            setIsUnlocked(true);
            setPasswordError('');
            setPasswordInput('');
          } else {
            setPasswordError('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™');
          }
        } catch (e) {
          setPasswordError('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        }
      };
      
      const [data, setData] = useState(() => {
        try { 
          const saved = localStorage.getItem('noteAppDataV2'); 
          if (saved) {
            const parsed = JSON.parse(saved);
            // ä¸è¶³ã—ã¦ã„ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’initialDataã‹ã‚‰è£œå®Œï¼ˆç©ºé…åˆ—ã®å ´åˆã‚‚initialDataä½¿ç”¨ï¼‰
            return { 
              ...initialData,
              ...parsed,
              tags: (parsed.tags && parsed.tags.length > 0) ? parsed.tags : initialData.tags,
              dailyTags: (parsed.dailyTags && parsed.dailyTags.length > 0) ? parsed.dailyTags : initialData.dailyTags,
              inputTags: (parsed.inputTags && parsed.inputTags.length > 0) ? parsed.inputTags : initialData.inputTags,
              widgetLayout: initialData.widgetLayout,
              creative: {
                ...initialData.creative,
                ...parsed.creative,
              }
            };
          }
          return initialData; 
        }
        catch { return initialData; }
      });

      const theme = getTheme(darkMode);
      
      // Gistã«ä¿å­˜
      const handleSaveToGist = async () => {
        if (!syncSettings.githubToken || !syncSettings.passwordHash) {
          alert('GitHubãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„');
          return;
        }
        
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—ï¼ˆè¨˜æ†¶ã•ã‚Œã¦ã‚‹å ´åˆã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãªã—ï¼‰
        let password = syncSettings.password;
        if (!password) {
          password = prompt('æš—å·åŒ–ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š');
          if (!password) return;
          
          // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
          const inputHash = await CryptoUtils.hashPassword(password);
          if (inputHash !== syncSettings.passwordHash) {
            alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™');
            return;
          }
          setSyncSettings(prev => ({ ...prev, password }));
          // rememberPasswordãŒONãªã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚‚ä¿å­˜
          if (syncSettings.rememberPassword) {
            localStorage.setItem('noteAppSavedPw', password);
          }
        }
        
        try {
          setSyncStatus('saving');
          const encrypted = await CryptoUtils.encrypt(data, password);
          const result = await GistAPI.saveToGist(
            syncSettings.githubToken,
            syncSettings.gistId,
            encrypted,
            syncSettings.passwordHash
          );
          
          // æ–°è¦ä½œæˆã®å ´åˆã€Gist IDã‚’ä¿å­˜
          if (!syncSettings.gistId) {
            setSyncSettings(prev => ({ ...prev, gistId: result.id }));
            localStorage.setItem('noteAppGistId', result.id);
          }
          
          setSyncStatus('saved');
          setTimeout(() => setSyncStatus(''), 3000);
        } catch (e) {
          console.error('Gist save error:', e);
          setSyncStatus('error');
          alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message);
          setTimeout(() => setSyncStatus(''), 3000);
        }
      };
      
      // Gistã‹ã‚‰èª­ã¿è¾¼ã¿
      const handleLoadFromGist = async () => {
        if (!syncSettings.githubToken || !syncSettings.gistId || !syncSettings.passwordHash) {
          alert('GitHubãƒˆãƒ¼ã‚¯ãƒ³ã€Gist IDã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„');
          return;
        }
        
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—
        let password = syncSettings.password;
        if (!password) {
          password = prompt('æš—å·åŒ–ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š');
          if (!password) return;
          
          // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
          const inputHash = await CryptoUtils.hashPassword(password);
          if (inputHash !== syncSettings.passwordHash) {
            alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™');
            return;
          }
          setSyncSettings(prev => ({ ...prev, password }));
          // rememberPasswordãŒONãªã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚‚ä¿å­˜
          if (syncSettings.rememberPassword) {
            localStorage.setItem('noteAppSavedPw', password);
          }
        }
        
        if (!confirm('ã‚¯ãƒ©ã‚¦ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ã§ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆç¾åœ¨ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã¯å¤±ã‚ã‚Œã¾ã™ï¼‰')) {
          return;
        }
        
        try {
          setSyncStatus('loading');
          const gistData = await GistAPI.loadFromGist(syncSettings.githubToken, syncSettings.gistId);
          
          console.log('Gist data received:', gistData);
          
          // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã®æ¤œè¨¼
          if (gistData.hash !== syncSettings.passwordHash) {
            throw new Error('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚åˆ¥ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§æš—å·åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚');
          }
          
          const decrypted = await CryptoUtils.decrypt(gistData.encrypted, password);
          
          console.log('Decrypted data:', decrypted);
          
          // ãƒ‡ãƒãƒƒã‚°: ãƒ‡ãƒ¼ã‚¿ã®ä¸­èº«ã‚’è©³ã—ãç¢ºèª
          const inProgressCount = decrypted?.creative?.inProgress?.length || 0;
          const completedCount = decrypted?.creative?.completed?.length || 0;
          const onHoldCount = decrypted?.creative?.onHold?.length || 0;
          const memoCount = decrypted?.memos?.length || 0;
          const dailyMemoCount = decrypted?.dailyMemos?.length || 0;
          const inputCount = decrypted?.input?.length || 0;
          
          // localStorageã«ä¿å­˜
          localStorage.setItem('noteAppDataV2', JSON.stringify(decrypted));
          
          // ä¿å­˜ç¢ºèª
          const saved = localStorage.getItem('noteAppDataV2');
          console.log('Saved to localStorage:', saved ? 'Yes' : 'No', 'Length:', saved?.length);
          
          // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¾Œã«ãƒªãƒ­ãƒ¼ãƒ‰
          alert(`èª­ã¿è¾¼ã¿å®Œäº†ï¼\n\né€²è¡Œä¸­: ${inProgressCount}\nå®Œäº†: ${completedCount}\nä¸­æ–­: ${onHoldCount}\næ—¥å¸¸ãƒ¡ãƒ¢: ${dailyMemoCount}\nInput: ${inputCount}\n\nãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¾ã™ã€‚`);
          window.location.reload();
          
        } catch (e) {
          console.error('Gist load error:', e);
          setSyncStatus('error');
          alert('èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message);
          setTimeout(() => setSyncStatus(''), 3000);
        }
      };

      // äº’æ›æ€§ã®ãŸã‚
      const selectedItem = openPanes.find(p => p.id === activePaneId) || openPanes[0] || null;

      // ã‚¢ã‚¤ãƒ†ãƒ ã‚’é–‹ãï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒšã‚¤ãƒ³ã§é–‹ãã€ãªã‘ã‚Œã°æ–°è¦ä½œæˆï¼‰
      const setSelectedItem = (item) => {
        if (!item) return;
        // æ—¢ã«é–‹ã„ã¦ã„ã‚‹ã‹ç¢ºèª
        const existingIndex = openPanes.findIndex(p => p.id === item.id);
        if (existingIndex >= 0) {
          // æ—¢ã«é–‹ã„ã¦ã„ã‚‹ â†’ ãã®ãƒšã‚¤ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
          setActivePaneId(item.id);
          return;
        }
        
        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒšã‚¤ãƒ³ãŒã‚ã‚Œã°ã€ãã®å†…å®¹ã‚’ç½®ãæ›ãˆ
        if (activePaneId && openPanes.some(p => p.id === activePaneId)) {
          setOpenPanes(prev => prev.map(p => p.id === activePaneId ? item : p));
          setActivePaneId(item.id);
        } else if (openPanes.length > 0) {
          // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒšã‚¤ãƒ³ãŒãªã„ã‘ã©ãƒšã‚¤ãƒ³ãŒã‚ã‚‹ â†’ æœ€åˆã®ãƒšã‚¤ãƒ³ã‚’ç½®ãæ›ãˆ
          setOpenPanes(prev => [item, ...prev.slice(1)]);
          setActivePaneId(item.id);
        } else {
          // ãƒšã‚¤ãƒ³ãŒãªã„ â†’ æ–°è¦ä½œæˆ
          setOpenPanes([item]);
          setActivePaneId(item.id);
        }
      };

      // æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
      const openInNewPane = (item) => {
        if (!item) return;
        // æ—¢ã«é–‹ã„ã¦ã„ã‚‹ã‹ç¢ºèª
        const existingIndex = openPanes.findIndex(p => p.id === item.id);
        if (existingIndex >= 0) {
          setActivePaneId(item.id);
          return;
        }
        
        // æœ€å¤§3ãƒšã‚¤ãƒ³ã¾ã§
        if (openPanes.length >= 3) {
          setOpenPanes(prev => [...prev.slice(1), item]);
        } else {
          setOpenPanes(prev => [...prev, item]);
        }
        setActivePaneId(item.id);
      };

      // ãƒšã‚¤ãƒ³ã‚’é–‰ã˜ã‚‹
      const closePane = (paneId) => {
        setOpenPanes(prev => {
          const newPanes = prev.filter(p => p.id !== paneId);
          // é–‰ã˜ãŸã®ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒšã‚¤ãƒ³ã ã£ãŸå ´åˆã€åˆ¥ã®ãƒšã‚¤ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
          if (paneId === activePaneId && newPanes.length > 0) {
            setActivePaneId(newPanes[newPanes.length - 1].id);
          } else if (newPanes.length === 0) {
            setActivePaneId(null);
          }
          return newPanes;
        });
      };

      // ãƒšã‚¤ãƒ³ã®å†…å®¹ã‚’æ›´æ–°
      const updatePaneContent = (paneId, content) => {
        setOpenPanes(prev => prev.map(p => p.id === paneId ? { ...p, content } : p));
      };

      useEffect(() => {
        const timer = setTimeout(() => localStorage.setItem('noteAppDataV2', JSON.stringify(data)), 500);
        return () => clearTimeout(timer);
      }, [data]);

      // ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒªã‚µã‚¤ã‚º
      const handleMouseDown = () => setIsResizing(true);
      useEffect(() => {
        const handleMouseMove = (e) => {
          if (isResizing) {
            const newWidth = Math.min(Math.max(200, e.clientX - 64), 500);
            setSidebarWidth(newWidth);
          }
        };
        const handleMouseUp = () => setIsResizing(false);
        if (isResizing) {
          document.addEventListener('mousemove', handleMouseMove);
          document.addEventListener('mouseup', handleMouseUp);
        }
        return () => {
          document.removeEventListener('mousemove', handleMouseMove);
          document.removeEventListener('mouseup', handleMouseUp);
        };
      }, [isResizing]);

      // ãƒšã‚¤ãƒ³ãƒªã‚µã‚¤ã‚º
      const paneContainerRef = useRef(null);
      const handlePaneResizeStart = (index) => setResizingPane(index);
      useEffect(() => {
        const handlePaneMouseMove = (e) => {
          if (resizingPane !== null && paneContainerRef.current) {
            const container = paneContainerRef.current;
            const rect = container.getBoundingClientRect();
            const totalWidth = rect.width;
            const mouseX = e.clientX - rect.left;
            
            // ãƒªã‚µã‚¤ã‚¶ãƒ¼ã®å·¦å´ã®ãƒšã‚¤ãƒ³ãŸã¡ã®åˆè¨ˆå¹…ã‚’è¨ˆç®—
            let leftPanesWidth = 0;
            for (let i = 0; i < resizingPane; i++) {
              leftPanesWidth += (paneWidths[openPanes[i]?.id] || 1) / openPanes.length * totalWidth;
            }
            
            // æ–°ã—ã„å¹…ã‚’è¨ˆç®—ï¼ˆæœ€å°300pxï¼‰
            const newWidth = Math.max(300, mouseX - leftPanesWidth);
            const newFlex = (newWidth / totalWidth) * openPanes.length;
            
            setPaneWidths(prev => ({
              ...prev,
              [openPanes[resizingPane].id]: Math.max(0.3, Math.min(2.5, newFlex))
            }));
          }
        };
        const handlePaneMouseUp = () => setResizingPane(null);
        if (resizingPane !== null) {
          document.addEventListener('mousemove', handlePaneMouseMove);
          document.addEventListener('mouseup', handlePaneMouseUp);
        }
        return () => {
          document.removeEventListener('mousemove', handlePaneMouseMove);
          document.removeEventListener('mouseup', handlePaneMouseUp);
        };
      }, [resizingPane, openPanes, paneWidths]);

      const updateItemContent = (itemId, content, paneItem) => {
        if (!paneItem) return;
        
        setData(prev => {
          let newData = { ...prev };
          
          // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã®æ›´æ–°ï¼ˆchapterã‚¿ã‚¤ãƒ—ã®ã¿ï¼‰
          if (paneItem.type === 'chapter' && !paneItem.isIdea && !paneItem.isHoldItem) {
            const now = new Date();
            const today = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
            const currentPane = openPanes.find(p => p.id === itemId);
            const prevContent = currentPane ? currentPane.content : paneItem.content;
            const prevCount = (prevContent || '').replace(/[\s\n]/g, '').length;
            const newCount = content.replace(/[\s\n]/g, '').length;
            const diff = newCount - prevCount;
            if (diff !== 0) {
              const currentProgress = prev.progress[today] || 0;
              const newProgress = Math.max(0, currentProgress + diff);
              newData = { ...newData, progress: { ...newData.progress, [today]: newProgress } };
            }
          }
          
          // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ›´æ–°
          if (paneItem.isIdea) {
            const ideas = prev.creative.ideas || [];
            newData = { ...newData, creative: { ...newData.creative, ideas: ideas.map(i => i.id === itemId ? { ...i, content } : i) } };
          } else if (paneItem.isHoldItem) {
            newData = { ...newData, creative: { ...newData.creative, holdItems: (prev.creative.holdItems || []).map(i => i.id === itemId ? { ...i, content } : i) } };
          } else {
            const { status } = paneItem;
            newData = { ...newData, creative: { ...newData.creative, [status]: prev.creative[status].map(p => p.id === paneItem.projectId ? { ...p, items: p.items.map(i => i.id === itemId ? { ...i, content } : i) } : p) } };
          }
          
          return newData;
        });
        
        updatePaneContent(itemId, content);
      };

      // ãƒ¢ãƒã‚¤ãƒ«åˆ¤å®š
      const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);
      const [showMobileSidebar, setShowMobileSidebar] = useState(false);
      
      useEffect(() => {
        const handleResize = () => setIsMobile(window.innerWidth <= 768);
        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
      }, []);

      const navItems = [
        { id: 'home', icon: <Icons.Home />, label: 'ãƒ›ãƒ¼ãƒ ' },
        { id: 'creative', icon: <Icons.Edit />, label: 'å‰µä½œ' },
        { id: 'daily', icon: <Icons.FileText />, label: 'æ—¥å¸¸' },
        { id: 'input', icon: <Icons.Book />, label: 'Input' },
      ];

      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯ç”»é¢ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šæ¸ˆã¿ã®å ´åˆï¼‰
      if (!isUnlocked && syncSettings.passwordHash) {
        return (
          <div style={{ display: 'flex', height: '100vh', background: theme.bg, color: theme.text, fontFamily: '"Noto Sans JP", sans-serif', alignItems: 'center', justifyContent: 'center' }}>
            <div style={{ background: theme.bgSecondary, borderRadius: '16px', padding: '40px', maxWidth: '400px', width: '90%', border: `1px solid ${theme.border}`, textAlign: 'center' }}>
              <div style={{ fontSize: '48px', marginBottom: '16px' }}>ğŸ”</div>
              <h2 style={{ fontSize: '20px', fontWeight: '600', marginBottom: '8px' }}>NoteApp</h2>
              <p style={{ fontSize: '13px', color: theme.textSecondary, marginBottom: '24px' }}>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
              
              <div style={{ position: 'relative', marginBottom: '16px' }}>
                <input 
                  type={showPasswordInput ? 'text' : 'password'}
                  value={passwordInput}
                  onChange={(e) => { setPasswordInput(e.target.value); setPasswordError(''); }}
                  onKeyDown={(e) => e.key === 'Enter' && handlePasswordSubmit()}
                  placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                  autoFocus
                  style={{ 
                    width: '100%', 
                    padding: '14px 44px 14px 16px', 
                    background: theme.bg, 
                    border: `1px solid ${passwordError ? theme.error : theme.border}`, 
                    borderRadius: '8px', 
                    color: theme.text, 
                    fontSize: '15px', 
                    outline: 'none',
                    boxSizing: 'border-box'
                  }}
                />
                <button 
                  onClick={() => setShowPasswordInput(!showPasswordInput)} 
                  style={{ 
                    position: 'absolute', 
                    right: '12px', 
                    top: '50%', 
                    transform: 'translateY(-50%)', 
                    background: 'none', 
                    border: 'none', 
                    color: theme.textSecondary, 
                    cursor: 'pointer',
                    padding: '4px'
                  }}
                >
                  {showPasswordInput ? <Icons.EyeOff /> : <Icons.Eye />}
                </button>
              </div>
              
              <label style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px', marginBottom: '16px', fontSize: '12px', color: theme.textSecondary, cursor: 'pointer' }}>
                <input 
                  type="checkbox"
                  checked={syncSettings.rememberPassword}
                  onChange={(e) => {
                    setSyncSettings(prev => ({ ...prev, rememberPassword: e.target.checked }));
                    if (e.target.checked) {
                      localStorage.setItem('noteAppRememberPw', 'true');
                    } else {
                      localStorage.removeItem('noteAppRememberPw');
                      localStorage.removeItem('noteAppSavedPw');
                    }
                  }}
                />
                ã“ã®ç«¯æœ«ã§ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨˜æ†¶ã™ã‚‹
              </label>
              
              {passwordError && (
                <p style={{ fontSize: '12px', color: theme.error, marginBottom: '16px' }}>{passwordError}</p>
              )}
              
              <button 
                onClick={handlePasswordSubmit}
                style={{ 
                  width: '100%', 
                  padding: '14px', 
                  background: theme.accent, 
                  color: '#fff', 
                  border: 'none', 
                  borderRadius: '8px', 
                  cursor: 'pointer', 
                  fontSize: '15px',
                  fontWeight: '500'
                }}
              >
                ãƒ­ãƒƒã‚¯è§£é™¤
              </button>
              
              <p style={{ fontSize: '11px', color: theme.textSecondary, marginTop: '24px' }}>
                ğŸ›¡ï¸ ãƒ‡ãƒ¼ã‚¿ã¯æš—å·åŒ–ã•ã‚Œã¦ä¿è­·ã•ã‚Œã¦ã„ã¾ã™
              </p>
            </div>
          </div>
        );
      }
      
      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æœªè¨­å®š ã‹ã¤ localStorageã«ãƒ‡ãƒ¼ã‚¿ãŒãªã„ ã‹ã¤ ãƒ­ãƒƒã‚¯çŠ¶æ…‹ â†’ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç”»é¢
      const hasLocalData = localStorage.getItem('noteAppDataV2');
      if (!isUnlocked && !syncSettings.passwordHash && !hasLocalData) {
        // ç§˜å¯†ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: ãƒ­ã‚´ã‚’5å›ã‚¿ãƒƒãƒ—ã§è¨­å®šç”»é¢ã¸
        const handleSecretTap = () => {
          const newCount = secretTapCount + 1;
          setSecretTapCount(newCount);
          if (newCount >= 5) {
            setIsUnlocked(true);
            setCurrentSection('settings');
            setSecretTapCount(0);
          }
        };
        
        return (
          <div style={{ display: 'flex', height: '100vh', background: theme.bg, color: theme.text, fontFamily: '"Noto Sans JP", sans-serif', alignItems: 'center', justifyContent: 'center' }}>
            <div style={{ background: theme.bgSecondary, borderRadius: '16px', padding: '40px', maxWidth: '400px', width: '90%', border: `1px solid ${theme.border}`, textAlign: 'center' }}>
              <div 
                onClick={handleSecretTap} 
                style={{ fontSize: '48px', marginBottom: '16px', cursor: 'default', userSelect: 'none' }}
              >ğŸ”’</div>
              <h2 style={{ fontSize: '20px', fontWeight: '600', marginBottom: '8px' }}>ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¢ãƒ—ãƒª</h2>
              <p style={{ fontSize: '13px', color: theme.textSecondary }}>
                ã“ã®ã‚¢ãƒ—ãƒªã¯éå…¬é–‹ã§ã™
              </p>
            </div>
          </div>
        );
      }

      return (
        <div style={{ display: 'flex', flexDirection: isMobile ? 'column' : 'row', height: '100vh', background: theme.bg, color: theme.text, fontFamily: '"Noto Sans JP", sans-serif', overflow: 'hidden' }}>
          
          {/* PCç”¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå·¦ã‚µã‚¤ãƒ‰ï¼‰ */}
          {!isMobile && (
            <div style={{ width: '64px', background: theme.bgSecondary, borderRight: `1px solid ${theme.border}`, display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '16px 0' }}>
              <div style={{ fontSize: '24px', marginBottom: '24px' }}>ğŸ““</div>
              {navItems.map(item => (
                <button key={item.id} onClick={() => setCurrentSection(item.id)} title={item.label} style={{ width: '44px', height: '44px', borderRadius: '12px', border: 'none', background: currentSection === item.id ? theme.accent : 'transparent', color: currentSection === item.id ? '#fff' : theme.textSecondary, cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '8px', transition: 'all 0.2s' }}>{item.icon}</button>
              ))}
              <div style={{ flex: 1 }} />
              <button onClick={() => setDarkMode(!darkMode)} style={{ width: '44px', height: '44px', borderRadius: '12px', border: 'none', background: 'transparent', color: theme.textSecondary, cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center' }} title={darkMode ? 'ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰' : 'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰'}>{darkMode ? <Icons.Sun /> : <Icons.Moon />}</button>
              <button onClick={() => setCurrentSection('settings')} style={{ width: '44px', height: '44px', borderRadius: '12px', border: 'none', background: currentSection === 'settings' ? theme.accent : 'transparent', color: currentSection === 'settings' ? '#fff' : theme.textSecondary, cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', marginTop: '8px' }} title="è¨­å®š"><Icons.Settings /></button>
            </div>
          )}

          {/* PCç”¨ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆå‰µä½œæ™‚ã®ã¿ï¼‰ */}
          {!isMobile && currentSection === 'creative' && (
            <>
              <div style={{ width: sidebarWidth, background: theme.bgSecondary, borderRight: `1px solid ${theme.border}`, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
                <div style={{ padding: '16px', borderBottom: `1px solid ${theme.border}`, fontWeight: '600', fontSize: '15px' }}>âœï¸ å‰µä½œ</div>
                <CreativeSection data={data} setData={setData} selectedItem={selectedItem} setSelectedItem={setSelectedItem} openInNewPane={openInNewPane} theme={theme} sidebarWidth={sidebarWidth} />
              </div>
              <div className="resizer" onMouseDown={handleMouseDown} style={{ background: isResizing ? theme.accent : 'transparent' }} />
            </>
          )}

          {/* ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰ */}
          {isMobile && showMobileSidebar && currentSection === 'creative' && (
            <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 60, background: theme.bgSecondary, zIndex: 999, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
              <div style={{ padding: '16px', borderBottom: `1px solid ${theme.border}`, fontWeight: '600', fontSize: '15px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <span>âœï¸ å‰µä½œ</span>
                <button onClick={() => setShowMobileSidebar(false)} style={{ background: 'none', border: 'none', color: theme.textSecondary, cursor: 'pointer', padding: '8px' }}><Icons.X /></button>
              </div>
              <CreativeSection 
                data={data} 
                setData={setData} 
                selectedItem={selectedItem} 
                setSelectedItem={(item) => { setSelectedItem(item); setShowMobileSidebar(false); }} 
                openInNewPane={(item) => { openInNewPane(item); setShowMobileSidebar(false); }} 
                theme={theme} 
                sidebarWidth={window.innerWidth} 
              />
            </div>
          )}

          {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
          <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden', paddingBottom: isMobile ? '60px' : 0 }}>
            
            {/* ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå‰µä½œæ™‚ã®ã¿ï¼‰ */}
            {isMobile && currentSection === 'creative' && (
              <div style={{ padding: '12px 16px', background: theme.bgSecondary, borderBottom: `1px solid ${theme.border}`, display: 'flex', alignItems: 'center', gap: '12px' }}>
                <button onClick={() => setShowMobileSidebar(true)} style={{ background: theme.accent, border: 'none', color: '#fff', cursor: 'pointer', padding: '8px 12px', borderRadius: '8px', display: 'flex', alignItems: 'center', gap: '6px', fontSize: '13px' }}>
                  <Icons.Folder /> ä½œå“ä¸€è¦§
                </button>
                {selectedItem && <span style={{ fontSize: '13px', color: theme.textSecondary, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{selectedItem.name}</span>}
              </div>
            )}
            
            {currentSection === 'home' && <HomeScreen data={data} setData={setData} theme={theme} />}
            {currentSection === 'creative' && (
              <div ref={paneContainerRef} style={{ flex: 1, display: 'flex', overflow: 'hidden' }}>
                {openPanes.length === 0 ? (
                  <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: theme.textSecondary, textAlign: 'center', padding: '20px' }}>
                    {isMobile ? 'ã€Œä½œå“ä¸€è¦§ã€ã‹ã‚‰é¸æŠã—ã¦ã­' : 'å·¦ã®ãƒªã‚¹ãƒˆã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ã­'}<br/>
                    {!isMobile && <span style={{ fontSize: '12px', marginTop: '8px', opacity: 0.7 }}>è¤‡æ•°é¸æŠã™ã‚‹ã¨ç”»é¢åˆ†å‰²ã§è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆ</span>}
                  </div>
                ) : (
                  isMobile ? (
                    // ãƒ¢ãƒã‚¤ãƒ«ï¼š1ãƒšã‚¤ãƒ³ã®ã¿è¡¨ç¤ºï¼ˆæœ€å¾Œã«é¸æŠã—ãŸã‚‚ã®ï¼‰
                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
                      <SplitEditor pane={openPanes[openPanes.length - 1]} onUpdate={(content) => updateItemContent(openPanes[openPanes.length - 1].id, content, openPanes[openPanes.length - 1])} theme={theme} data={data} setData={setData} />
                    </div>
                  ) : (
                    // PCï¼šè¤‡æ•°ãƒšã‚¤ãƒ³
                    openPanes.map((pane, index) => (
                      <React.Fragment key={pane.id}>
                        {index > 0 && (
                          <div 
                            onMouseDown={() => handlePaneResizeStart(index - 1)}
                            style={{ width: '6px', background: resizingPane === index - 1 ? theme.accent : theme.border, cursor: 'col-resize', transition: 'background 0.2s', flexShrink: 0 }} 
                            onMouseOver={(e) => e.target.style.background = theme.accent}
                            onMouseOut={(e) => { if (resizingPane !== index - 1) e.target.style.background = theme.border; }}
                          />
                        )}
                        <div style={{ flex: paneWidths[pane.id] || 1, display: 'flex', flexDirection: 'column', overflow: 'hidden', minWidth: '300px' }}>
                          <div 
                            onClick={() => setActivePaneId(pane.id)}
                            style={{ padding: '8px 12px', background: theme.bgSecondary, borderBottom: activePaneId === pane.id ? `2px solid ${theme.accent}` : `1px solid ${theme.border}`, display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}
                          >
                            {pane.isIdea ? <Icons.Lightbulb /> : pane.isHoldItem ? <Icons.Pause /> : pane.type === 'memo' ? <Icons.File /> : <Icons.FileText />}
                            <span style={{ flex: 1, fontSize: '12px', fontWeight: activePaneId === pane.id ? '600' : '500', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap', color: activePaneId === pane.id ? theme.accent : theme.text }}>
                              {pane.isIdea ? pane.title : pane.name}
                            </span>
                            <button onClick={(e) => { e.stopPropagation(); closePane(pane.id); }} style={{ background: 'none', border: 'none', color: theme.textSecondary, cursor: 'pointer', padding: '2px', display: 'flex' }}><Icons.X /></button>
                          </div>
                          <SplitEditor pane={pane} onUpdate={(content) => updateItemContent(pane.id, content, pane)} theme={theme} data={data} setData={setData} />
                        </div>
                      </React.Fragment>
                    ))
                  )
                )}
              </div>
            )}
            {currentSection === 'daily' && <DailySection data={data} setData={setData} theme={theme} />}
            {currentSection === 'input' && <InputSection data={data} setData={setData} theme={theme} />}
            {currentSection === 'settings' && <SettingsScreen data={data} setData={setData} theme={theme} syncSettings={syncSettings} setSyncSettings={setSyncSettings} onSaveToGist={handleSaveToGist} onLoadFromGist={handleLoadFromGist} syncStatus={syncStatus} />}
          </div>

          {/* ãƒ¢ãƒã‚¤ãƒ«ç”¨ä¸‹éƒ¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */}
          {isMobile && (
            <div style={{ position: 'fixed', bottom: 0, left: 0, right: 0, height: '60px', background: theme.bgSecondary, borderTop: `1px solid ${theme.border}`, display: 'flex', justifyContent: 'space-around', alignItems: 'center', zIndex: 1000 }}>
              {navItems.map(item => (
                <button key={item.id} onClick={() => { setCurrentSection(item.id); setShowMobileSidebar(false); }} style={{ flex: 1, height: '100%', border: 'none', background: 'transparent', color: currentSection === item.id ? theme.accent : theme.textSecondary, cursor: 'pointer', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', gap: '4px' }}>
                  {item.icon}
                  <span style={{ fontSize: '10px' }}>{item.label}</span>
                </button>
              ))}
              <button onClick={() => setCurrentSection('settings')} style={{ flex: 1, height: '100%', border: 'none', background: 'transparent', color: currentSection === 'settings' ? theme.accent : theme.textSecondary, cursor: 'pointer', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', gap: '4px' }}>
                <Icons.Settings />
                <span style={{ fontSize: '10px' }}>è¨­å®š</span>
              </button>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<NoteApp />);
  </script>
</body>
</html>
